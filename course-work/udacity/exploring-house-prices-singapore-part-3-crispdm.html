
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Exploring Residential House Prices in Singapore &#8212; ΨΦ</title>
    
  <link rel="stylesheet" href="../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/default.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://jeffchenchengyi.github.io/course-work/udacity/exploring-house-prices-singapore-part-3-crispdm.html" />
    <link rel="shortcut icon" href="../../_static/jeffchenchengyi2019.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Center for AI in Society’s Student Branch (CAIS++)" href="../cais%2B%2B/intro.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />


<!-- Opengraph tags -->
<meta property="og:url"         content="https://jeffchenchengyi.github.io/course-work/udacity/exploring-house-prices-singapore-part-3-crispdm.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Exploring Residential House Prices in Singapore" />
<meta property="og:description" content="Exploring Residential House Prices in Singapore  By: Chengyi (Jeff) Chen  In this project, we will be exploring housing prices and features in Singapore, trying" />
<meta property="og:image"       content="https://jeffchenchengyi.github.io/_static/jeffchenchengyi2019.jpg" />

<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/jeffchenchengyi2019.jpg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">ΨΦ</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  Machine Learning Notes
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../notes/ml-ifaqs.html">
   Infrequently Asked Questions in ML
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../notes/uplift-modelling-and-contextual-bandits.html">
   Uplift Modelling and Contextual Bandits
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../notes/probabilistic-machine-learning/00-objective.html">
   Probabilistic Machine Learning
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../notes/probabilistic-machine-learning/01-frequentist-bayesian.html">
     Frequentist Vs. Bayesian Methods
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Personal Projects
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../projects/bayesian-contextual-bandits.html">
   Bayesian Contextual Bandits
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../projects/wtte-rnn-pyro.html">
   Weibull Time To Event Recurrent Neural Net in Pyro
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Featured Course Work &amp; Extra-curriculars
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../ise-562/intro.html">
   ISE-562 Decision Analysis
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-562/lab_assignment.html">
     Certain Equivalents and Sensitivity Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-562/midterm.html">
     Mid Term Part (2): Individual Assignment: Tornado Diagrams and Bidding
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../ise-533/intro.html">
   ISE-533 Integrative Analytics
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-533/hw1.html">
     HW 1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-533/hw2.html">
     HW 2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-533/project1.html">
     Project 1: Group Restaurants Choice
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-533/project2.html">
     Project 2: Multi-location Transshipment Problem
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../ise-537/intro.html">
   ISE-537 Financial Analytics
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-537/hw1.html">
     HW 1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-537/hw2_part1.html">
     HW 2 Part 1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-537/hw2_part2.html">
     HW 2 Part 2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-537/hw3.html">
     HW 3
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../ise-537/market-observations.html">
     Market Observations
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../ise-537/market-observations-week-1.html">
       MO 1: TSLA Absurd P/E Ratio
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ise-537/market-observations-week-2.html">
       MO 2: The NASDAQ Whale
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ise-537/market-observations-week-3.html">
       MO 4: Dovish till 2024
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ise-537/market-observations-week-4.html">
       MO 4: The Future of EV batteries
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ise-537/market-observations-week-5.html">
       MO 5: Palantir
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../ise-537/paper-reviews.html">
     Paper Reviews
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../ise-537/paper-review-1.html">
       Paper Review 1: Value and Momentum Everywhere
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ise-537/paper-review-2.html">
       Paper Review 2: Carry
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ise-537/paper-review-3.html">
       Paper Review 3: Quality Minus Junk
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ise-537/paper-review-4.html">
       Paper Review 4: Size Matters, if You Control Your Junk
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ise-537/paper-review-5.html">
       Paper Review 5: The Low-Risk Anomaly: A Decomposition into Micro and Macro Effects
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-537/project1.html">
     Project 1: Momentum Strategies
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-537/project2.html">
     Project 2: Carry
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-537/notes.html">
     Notes
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../ise-530/intro.html">
   ISE-530 Optimization Analytics
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-530/hw1.html">
     HW 1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-530/hw2.html">
     HW 2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-530/hw3.html">
     HW 3
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-530/hw4.html">
     HW 4
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-530/hw5.html">
     HW 5
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-530/hw6.html">
     HW 6
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-530/hw7.html">
     HW 7
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-530/hw8.html">
     HW 8
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-530/hw9.html">
     HW 9
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-530/midterm.html">
     Midterm
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-530/final.html">
     Final
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ise-530/notes.html">
     Summary
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../csci-499/intro.html">
   CSCI-499 AI for Social Good
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../csci-499/paper-reviews.html">
     Paper Reviews
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../csci-499/paper-review-1.html">
       Paper Review 1
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../csci-499/paper-review-2.html">
       Paper Review 2
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../csci-499/paper-review-3.html">
       Paper Review 3
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../csci-499/paper-review-4.html">
       Paper Review 4
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../csci-499/paper-review-5.html">
       Paper Review 5
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../csci-499/paper-review-6.html">
       Paper Review 6
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../csci-499/paper-review-7.html">
       Paper Review 7
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../csci-499/paper-review-8.html">
       Paper Review 8
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2">
    <a class="reference external" href="https://docs.google.com/presentation/d/1MqA1jPrUw2UUTnQBGHqH-_Y3FCcOgsUGoCG1LNnCvZY/edit?usp=sharing">
     Paper Review Presentation
     <i class="fas fa-external-link-alt">
     </i>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference external" href="https://github.com/lucashu1/education-deserts">
     Education Deserts Research
     <i class="fas fa-external-link-alt">
     </i>
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../cais%2B%2B/intro.html">
   CAIS++
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference external" href="https://github.com/pelillian/varro">
     Evolving FPGAs for Accelerated MachineLearning on Bare Metal
     <i class="fas fa-external-link-alt">
     </i>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference external" href="https://github.com/usc-caisplusplus/SLAB">
     OCR Research on Google Street View Panoramics
     <i class="fas fa-external-link-alt">
     </i>
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Udacity Data Scientist Nanodegree - Exploring House Prices in Singapore
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://graduation.udacity.com/confirm/2LGCCKNA">
   Udacity Data Scientist Nanodegree Certificate
   <i class="fas fa-external-link-alt">
   </i>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://drive.google.com/file/d/13GaYnn520MGQtO4PfYjP4W6KFqyyI10T/view?usp=sharing">
   Chengyi (Jeff) Chen's Resume
   <i class="fas fa-external-link-alt">
   </i>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/jeffchenchengyi/jeffchenchengyi.github.io">
   GitHub Repo
   <i class="fas fa-external-link-alt">
   </i>
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/course-work/udacity/exploring-house-prices-singapore-part-3-crispdm.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/jeffchenchengyi/jeffchenchengyi.github.io"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of Contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#business-understanding">
   Business Understanding
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-understanding">
   Data Understanding
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#condominiums">
     Condominiums
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-preparation">
   Data Preparation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scaling">
     Scaling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dimensionality-reduction">
     Dimensionality Reduction
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modeling">
   Modeling
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cluster-analysis">
     1. Cluster Analysis
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#feature-importance-regression-analysis">
     2. Feature Importance / Regression Analysis
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#popularity">
     3. Popularity
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualize-evolution-of-psf-over-time-for-d9-10-11-condos-to-be-continued">
     4. Visualize Evolution of PSF over time for D9, 10, 11 Condos [To Be Continued]
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#evaluation-to-be-continued">
   Evaluation [To Be Continued]
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deployment-to-be-continued">
   Deployment [To Be Continued]
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resources">
   Resources
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="exploring-residential-house-prices-in-singapore">
<h1>Exploring Residential House Prices in Singapore<a class="headerlink" href="#exploring-residential-house-prices-in-singapore" title="Permalink to this headline">¶</a></h1>
<p>By: Chengyi (Jeff) Chen</p>
<p>In this project, we will be exploring housing prices and features in Singapore, trying to see whether we can derive any cool insights. As a preliminary to this project, we’ve performed all the ETL operations necessary - scraping Singapore Residential housing prices and their features from <a class="reference external" href="https://www.99.co/singapore">99.co</a>, a popular online marketplace for property in Singapore, cleaned the data by both manually and also imputing missing values using a nearest neighbours approach.</p>
<img alt="https://thesmartlocal.com/wp-content/uploads/2014/09/images_easyblog_images_2088_Beautiful-Homes_Hillside-House-1.jpg" src="https://thesmartlocal.com/wp-content/uploads/2014/09/images_easyblog_images_2088_Beautiful-Homes_Hillside-House-1.jpg" />
<p><em>Disclaimer: The data that we have gathered might be of pretty low “resolution”. In our ETL pipelines, we’ve made a ton of assumptions when performing some of the manual cleaning. Moving forward, I’ll probably find a better data source (or make one myself lol) because having interacted with 99.co’s data, I’ve realized that though their data is quite structured, it lacks alot of key details that I might have been better off gathering from the official Urban Recreation Authority website of Singapore. But nonetheless, we’ll just work with what we have now</em></p>
<p>Here, we will explore the data we’ve scraped using the CRoss Industry Standard Process for Data Mining, or CRISP-DM.</p>
<hr class="docutils" />
<div class="section" id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h2>
<p>Cross-Industry Standard Process for Data Mining (CRISP-DM)</p>
<ol class="simple">
<li><p><a class="reference external" href="#business-understanding">Business understanding</a></p></li>
<li><p><a class="reference external" href="#data-understanding">Data understanding</a></p></li>
<li><p><a class="reference external" href="#data-prep">Data preparation</a></p></li>
<li><p><a class="reference external" href="#model">Modeling</a></p></li>
<li><p><a class="reference external" href="#eval">Evaluation</a></p></li>
<li><p><a class="reference external" href="#deploy">Deployment</a></p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># General Utilities for Web Scraping</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">isfile</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">isdir</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">dateutil</span> <span class="kn">import</span> <span class="n">relativedelta</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">pickle5</span> <span class="k">as</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">imp</span> <span class="kn">import</span> <span class="n">reload</span>
<span class="kn">import</span> <span class="nn">webscraper_99co</span>
<span class="kn">from</span> <span class="nn">webscraper_99co</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">reload</span><span class="p">(</span><span class="n">webscraper_99co</span><span class="p">);</span>

<span class="c1"># geopandas for getting property development area</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">descartes</span>
<span class="kn">from</span> <span class="nn">descartes</span> <span class="kn">import</span> <span class="n">PolygonPatch</span>

<span class="c1"># Shapely </span>
<span class="kn">import</span> <span class="nn">shapely</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">MultiPoint</span><span class="p">,</span> <span class="n">Polygon</span>
<span class="kn">from</span> <span class="nn">shapely</span> <span class="kn">import</span> <span class="n">wkt</span>

<span class="c1"># Machine Learning Utitilies</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">import</span> <span class="nn">matplotlib.font_manager</span> <span class="k">as</span> <span class="nn">fm</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.anchored_artists</span> <span class="kn">import</span> <span class="n">AnchoredSizeBar</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span><span class="p">,</span> <span class="n">FastICA</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">silhouette_score</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">silhouette_samples</span><span class="p">,</span> <span class="n">pairwise_distances_argmin_min</span>
<span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">AdaBoostRegressor</span><span class="p">,</span> <span class="n">GradientBoostingRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>

<span class="c1"># Url</span>
<span class="n">base_url</span> <span class="o">=</span> <span class="s1">&#39;https://www.99.co/singapore/sale&#39;</span>

<span class="c1"># 28 Designated districts</span>
<span class="n">sg_districts</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;City Business District&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Boat Quay, Chinatown, Havelock Road, Marina Square, Raffles Place, Suntec City&#39;</span><span class="p">),</span>
    <span class="mi">2</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;City Business District&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Anson Road, Chinatown, Neil Road, Raffles Place, Shenton Way, Tanjong Pagar&#39;</span><span class="p">),</span>
    <span class="mi">3</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Central South&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Alexandra Road, Tiong Bahru, Queenstown&#39;</span><span class="p">),</span>
    <span class="mi">4</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;South&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Keppel, Mount Faber, Sentosa, Telok Blangah&#39;</span><span class="p">),</span>
    <span class="mi">5</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;South West&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Buona Vista, Dover, Pasir Panjang, West Coast&#39;</span><span class="p">),</span>
    <span class="mi">6</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;City Business District&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;City Hall, High Street, North Bridge Road&#39;</span><span class="p">),</span>
    <span class="mi">7</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;City&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Beach Road, Bencoolen Road, Bugis, Rochor&#39;</span><span class="p">),</span>
    <span class="mi">8</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Central&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Little India, Farrer Park, Serangoon Road&#39;</span><span class="p">),</span>
    <span class="mi">9</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Central Orchard&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Cairnhill, Killiney, Leonie Hill, Orchard, Oxley&#39;</span><span class="p">),</span>
    <span class="mi">10</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Central Near Orchard&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Balmoral, Bukit Timah, Grange Road, Holland, Orchard Boulevard, River Valley, Tanglin Road&#39;</span><span class="p">),</span>
    <span class="mi">11</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Central Near Orchard&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Chancery, Bukit Timah, Dunearn Road, Newton&#39;</span><span class="p">),</span>
    <span class="mi">12</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Central&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Balestier, Moulmein, Novena, Toa Payoh&#39;</span><span class="p">),</span>
    <span class="mi">13</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Central East&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Potong Pasir, Machpherson&#39;</span><span class="p">),</span>
    <span class="mi">14</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Central East&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Eunos, Geylang, Kembangan, Paya Lebar&#39;</span><span class="p">),</span>
    <span class="mi">15</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;East Coast&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Katong, Marine Parade, Siglap, Tanjong Rhu&#39;</span><span class="p">),</span>
    <span class="mi">16</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Upper East Coast&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Bayshore, Bedok, Chai Chee&#39;</span><span class="p">),</span>
    <span class="mi">17</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Far East&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Changi, Loyang, Pasir Ris&#39;</span><span class="p">),</span>
    <span class="mi">18</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Far East&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Pasir Ris, Simei, Tampines&#39;</span><span class="p">),</span>
    <span class="mi">19</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;North East&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Hougang, Punggol, Sengkang&#39;</span><span class="p">),</span>
    <span class="mi">20</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Central North&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Ang Mo Kio, Bishan, Braddell Road, Thomson&#39;</span><span class="p">),</span>
    <span class="mi">21</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Central West&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Clementi, Upper Bukit Timah, Hume Avenue&#39;</span><span class="p">),</span>
    <span class="mi">22</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Far West&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Boon Lay, Jurong, Tuas&#39;</span><span class="p">),</span>
    <span class="mi">23</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;North West&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Bukit Batok, Choa Chu Kang, Hillview Avenue, Upper Bukit Timah&#39;</span><span class="p">),</span>
    <span class="mi">24</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Far North West&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Kranji, Lim Chu Kang, Sungei Gedong, Tengah&#39;</span><span class="p">),</span>
    <span class="mi">25</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Far North&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Admiralty, Woodlands&#39;</span><span class="p">),</span>
    <span class="mi">26</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;North&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Tagore, Yio Chu Kang&#39;</span><span class="p">),</span>
    <span class="mi">27</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Far North&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Admiralty, Sembawang, Yishun&#39;</span><span class="p">),</span>
    <span class="mi">28</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;North East&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;Seletar, Yio Chu Kang&#39;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># plotting defaults</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">get_colors</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">length</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Spectral&#39;</span><span class="p">)(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">length</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><a id='business-understanding'></a></p>
</div>
<hr class="docutils" />
<div class="section" id="business-understanding">
<h2>Business Understanding<a class="headerlink" href="#business-understanding" title="Permalink to this headline">¶</a></h2>
<p>This is the first stage of the CRISP-DM process. In the context of Singapore residential housing, what questions would we like to address and along what type of insights do we want to gather from this dataset?</p>
<p>A brief preliminary:</p>
<ul>
<li><p>Singapore’s residential real estate market contains both Public and Private Housing options.</p></li>
<li><p>Public Housing contains 2 main types, HDB Flats (subsidized and regulated by the Housing and Development Boards (hence HDB)) and Executive Condominiums that have facilities similar to that of private condominiums but cheaper. Private Housing contains Condominiums and Landed Property such as Bungalows. You can read more about the different housing types in Singapore <a class="reference external" href="https://www.99.co/blog/singapore/a-general-guide-to-types-of-housing-in-singapore/">here</a>.</p></li>
<li><p>There are several factors that affect the prices of Singapore houses that might be atypical from other places in the world. Factors such as how accessible schools / shopping malls / mrt (train station) are very important features that are factored into the  price of a house, on top of other things such as size. Condominiums and Landed Property around the primary shopping district in Singapore, Orchard Road, for example, are extremely expensive because of their accessibility. Hence, it’ll be really nice to be able to quantify how much these features affect their prices.</p></li>
<li><p>There are a multitude of other factors that affect the price of a property and whether a transaction will take place, these include features that can’t directly be observed (data isn’t that easily available) such as:</p>
<ol class="simple">
<li><p>Interior design of the apartment</p></li>
</ol>
<ul class="simple">
<li><p>View and Facing</p>
<ul>
<li><p>If a property is surrounded by a lot of other tall buildings, the price of lower floors will be much lower</p>
<ul>
<li><p>Hence, prices aren’t directly proportional to the floor - more like a piecewise function - e.g. an apartment located on the 30th floor while all surrounding property developments are &gt; 30 floors will have a comparatively lower price to the same property but on the 31st floor</p></li>
</ul>
</li>
<li><p>An apartment is facing prominent structures in Singapore such as the shopping mall, Marina Bay Sands, or places like Bukit Timah hill might call for a much higher price</p></li>
</ul>
</li>
<li><p>Size of the land plot of the property development</p>
<ul>
<li><p>The larger the size of the land that the property development owns, the more valuable it is as an investment opportunity, especially since Singapore is already so small</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Business Questions:</p>
<ol class="simple">
<li><p>Cluster Analysis - Currently, there are <a class="reference external" href="https://www.singaporeexpats.com/housing-in-singapore/singapore-district-guide.htm">28 designated districts</a> in Singapore. After clustering our data, could we discern these 28 districts well, or is there a different clustering of the data?</p></li>
<li><p>Feature Importance / Regression Analysis - Out of the physical features of the property we have gathered in our dataset, are there any that are most helpful in predicting the price of the house?</p></li>
<li><p>Popularity - What are the “hottest” properties now, especially in the District 9, 10, 11 area (Primary Shopping district)?</p></li>
</ol>
<p><a id='data-understanding'></a></p>
</div>
<hr class="docutils" />
<div class="section" id="data-understanding">
<h2>Data Understanding<a class="headerlink" href="#data-understanding" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># cleaned_dataset = pd.read_csv(&#39;./data/99.co/cleaned_dataset_{}.csv&#39;.format(date.today().strftime(&quot;%Y_%m_%d&quot;)), index_col=[0])</span>
<span class="n">cleaned_dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/99.co/cleaned_dataset_</span><span class="si">{}</span><span class="s1">.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;2019_07_11&#39;</span><span class="p">),</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">cleaned_dataset</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Cost of Renovation</th>
      <th>ammenities</th>
      <th>atm_nearby</th>
      <th>average_transit_duration_to_subway</th>
      <th>average_transit_duration_to_supermarket</th>
      <th>average_walking_duration_to_bus_station</th>
      <th>average_walking_duration_to_clinic</th>
      <th>num_baths</th>
      <th>num_beds</th>
      <th>num_bus_stations_nearby</th>
      <th>...</th>
      <th>Landed House Area Zoning_3 Storey Semi D</th>
      <th>Landed House Area Zoning_GCBA</th>
      <th>Landed House Area Zoning_Not Applicable</th>
      <th>Landed House Area Zoning_Not in Landed Housing Area</th>
      <th>Landed House Area Zoning_Others</th>
      <th>Re-wiring/Structural Renovation_No</th>
      <th>Re-wiring/Structural Renovation_Yes</th>
      <th>District</th>
      <th>type</th>
      <th>link</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>64.0</td>
      <td>18.00</td>
      <td>4.000000</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>10.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>D22</td>
      <td>hdb</td>
      <td>https://www.99.co/singapore/hdb/23-teban-garde...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>15.0</td>
      <td>0.0</td>
      <td>64.0</td>
      <td>172.00</td>
      <td>18.000000</td>
      <td>22.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>D19</td>
      <td>condo</td>
      <td>https://www.99.co/singapore/condos-apartments/...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>29.0</td>
      <td>1.0</td>
      <td>11.5</td>
      <td>10.00</td>
      <td>4.857143</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>10.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>D28</td>
      <td>condo</td>
      <td>https://www.99.co/singapore/condos-apartments/...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>64.0</td>
      <td>16.00</td>
      <td>5.100000</td>
      <td>2.8</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>10.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>D5</td>
      <td>hdb</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>14.0</td>
      <td>1.0</td>
      <td>11.0</td>
      <td>14.75</td>
      <td>4.800000</td>
      <td>5.2</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>10.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>D11</td>
      <td>condo</td>
      <td>https://www.99.co/singapore/condos-apartments/...</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 429 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># These features are either unrequired for our</span>
<span class="c1"># predictive models / will be used later in other analyses</span>
<span class="n">special_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;District&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;link&#39;</span><span class="p">]</span>

<span class="c1"># Store the landed house specific feats because we don&#39;t need them</span>
<span class="n">landed_specific_feats</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Cost of Renovation&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;months_since_last_renovation&#39;</span><span class="p">,</span>
    <span class="o">*</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cleaned_dataset</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()[:</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;condition&#39;</span><span class="p">)]</span> <span class="o">==</span> <span class="s1">&#39;condition&#39;</span><span class="p">],</span>
    <span class="o">*</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cleaned_dataset</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()[:</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;landed&#39;</span><span class="p">)]</span> <span class="o">==</span> <span class="s1">&#39;landed&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Re-wiring/Structural Renovation_No&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Re-wiring/Structural Renovation_Yes&#39;</span>
<span class="p">]</span>

<span class="n">availability_feats</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cleaned_dataset</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()[:</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;availability&#39;</span><span class="p">)]</span> <span class="o">==</span> <span class="s1">&#39;availability&#39;</span><span class="p">]</span>

<span class="c1"># Features that do not make sense for landed properties</span>
<span class="n">landed_feats_to_be_removed</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cleaned_dataset</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()[:</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;floor&#39;</span><span class="p">)]</span> <span class="o">==</span> <span class="s1">&#39;floor&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s take a look at the number of observations we have for each property type.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">property_type_counts</span> <span class="o">=</span> <span class="n">cleaned_dataset</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">property_type_counts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">property_type_counts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">get_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">property_type_counts</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Property Type Counts&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_9_0.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_9_0.png" />
</div>
</div>
<p>How about the district breakdown?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">property_district_counts</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cleaned_dataset</span><span class="p">[</span><span class="s1">&#39;District&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">kv</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">kv</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]))</span>
<span class="n">districts</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">property_district_counts</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">districts</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">get_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">property_district_counts</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;District Counts&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_11_0.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_11_0.png" />
</div>
</div>
<p>We are missing <code class="docutils literal notranslate"><span class="pre">D24</span></code>, and it appears that we have a highly imbalanced dataset - we have really few <code class="docutils literal notranslate"><span class="pre">D6</span></code> and <code class="docutils literal notranslate"><span class="pre">D26</span></code> properties, and a ton of <code class="docutils literal notranslate"><span class="pre">D19</span></code> properties. Let’s see the property type breakdown by district.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unstacked_district_counts_df</span> <span class="o">=</span> <span class="n">cleaned_dataset</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;District&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="o">*</span><span class="n">districts</span><span class="p">],</span> <span class="p">:]</span>
<span class="n">unstacked_district_counts_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> 
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;District breakdown by Property Types&#39;</span><span class="p">,</span>
    <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;Spectral&#39;</span><span class="p">,</span> 
    <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_13_0.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_13_0.png" />
</div>
</div>
<p>We do seem to have an overwhelmingly larger portion of condominium observations compared to HDBs or Landed properties. Hence, we’ll focus the analysis on condominiums.</p>
<div class="section" id="condominiums">
<h3>Condominiums<a class="headerlink" href="#condominiums" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">condo_X</span> <span class="o">=</span> <span class="n">cleaned_dataset</span><span class="p">[</span><span class="n">cleaned_dataset</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;condo&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>

<span class="n">condo_X</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;District&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="o">*</span><span class="n">districts</span><span class="p">],</span> <span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> 
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Condominium Counts by District&#39;</span><span class="p">,</span> 
    <span class="n">color</span><span class="o">=</span><span class="n">get_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">districts</span><span class="p">)),</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
<span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_height</span><span class="p">()),</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span><span class="o">+</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span><span class="o">+</span><span class="mi">10</span><span class="p">),</span> 
                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> 
                <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_17_0.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_17_0.png" />
</div>
</div>
<p>Let’s take a look at the heat map of the features of our condominiums to get a sense of which features might be helpful in helping explain the <code class="docutils literal notranslate"><span class="pre">price</span></code> of a condo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">condo_X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">landed_specific_feats</span> <span class="o">+</span> <span class="n">special_feats</span> <span class="o">+</span> <span class="n">availability_feats</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">corr</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_19_0.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_19_0.png" />
</div>
</div>
<p>Seems like there are no features that are correlated with <code class="docutils literal notranslate"><span class="pre">price</span></code>, but there are quite a few features that are either highly positively and negatively correlated with each other. For example, <code class="docutils literal notranslate"><span class="pre">average_transit_duration_to_subway</span></code>, <code class="docutils literal notranslate"><span class="pre">average_transit_duration_to_supermarket</span></code>, <code class="docutils literal notranslate"><span class="pre">average_walking_duration_to_bus_station</span></code>, <code class="docutils literal notranslate"><span class="pre">average_walking_duration_to_clinic</span></code> are highly positively correlated with each other, while they are highly negatively correlated with <code class="docutils literal notranslate"><span class="pre">atm_nearby</span></code>, a binary variable. Intuitively, this makes a lot of sense since places that are very accessible (near various transportation modes, clinics, and supermarkets) would likely be very near to atms. Let’s take a closer look at those correlated features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">condo_X</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span>
    <span class="s1">&#39;num_baths&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;num_beds&#39;</span><span class="p">,</span>
    <span class="s1">&#39;months_before_tenancy_lease_expiry&#39;</span><span class="p">,</span>
    <span class="o">*</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">condo_X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> 
      <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()[:</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;facing&#39;</span><span class="p">)]</span> <span class="o">==</span> <span class="s1">&#39;facing&#39;</span> <span class="ow">or</span> 
      <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()[:</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;condition&#39;</span><span class="p">)]</span> <span class="o">==</span> <span class="s1">&#39;condition&#39;</span> <span class="ow">or</span> 
      <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()[:</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;floor&#39;</span><span class="p">)]</span> <span class="o">==</span> <span class="s1">&#39;floor&#39;</span> <span class="ow">or</span> 
      <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()[:</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;furnishing&#39;</span><span class="p">)]</span> <span class="o">==</span> <span class="s1">&#39;furnishing&#39;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">landed_specific_feats</span> <span class="o">+</span> <span class="n">special_feats</span> <span class="o">+</span> <span class="n">availability_feats</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">corr</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_21_0.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_21_0.png" />
</div>
</div>
<p>Let’s zoom in to check on the <code class="docutils literal notranslate"><span class="pre">price</span></code> as well, just to make sure we aren’t seeing anything abnormal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">condo_X</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    6.267000e+03
mean     2.972129e+06
std      5.471618e+07
min      4.950000e+05
25%      9.950000e+05
50%      1.420000e+06
75%      2.081500e+06
max      3.850000e+09
Name: price, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">condo_X</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Price Boxplot&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">condo_X</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Price Histogram&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">condo_X</span><span class="p">[</span><span class="s1">&#39;sqft&#39;</span><span class="p">],</span> <span class="n">condo_X</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;sqft&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Price Vs. Sqft&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_24_0.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_24_0.png" />
</div>
</div>
<p>We definitely see outliers over here. Firstly, we have 2 condominiums that are in the price range of billions (maybe possible for a very high class bungalow, but highly unlikely for any condo) and also a condo that’s very low in price but with a huge sqft. Let’s remove them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">condo_X</span> <span class="o">=</span> <span class="n">condo_X</span><span class="p">[</span><span class="n">condo_X</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1e8</span><span class="p">]</span> <span class="c1"># Remove condos above 100 mil</span>
<span class="n">condo_X</span> <span class="o">=</span> <span class="n">condo_X</span><span class="p">[</span><span class="n">condo_X</span><span class="p">[</span><span class="s1">&#39;sqft&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">7e5</span><span class="p">]</span> <span class="c1"># Remove that outlier condo with a huge sqft</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">condo_X</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Price Boxplot&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">condo_X</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Price Histogram&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">condo_X</span><span class="p">[</span><span class="s1">&#39;sqft&#39;</span><span class="p">],</span> <span class="n">condo_X</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;sqft&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Price Vs. Sqft&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_26_0.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_26_0.png" />
</div>
</div>
<p>Much better! We see a good number of condos that have prices in the 10 mil and above range but below 60 mil that might probably be penthouses and majority of condos are below 10 mil logically. Let’s proceed on with the Data Preparation stage!</p>
<p><a id='data-prep'></a></p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="data-preparation">
<h2>Data Preparation<a class="headerlink" href="#data-preparation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="scaling">
<h3>Scaling<a class="headerlink" href="#scaling" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_scaler</span><span class="p">,</span> <span class="n">y_scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">StandardScaler</span><span class="p">()</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">condo_X</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span>
    <span class="s1">&#39;num_baths&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;num_beds&#39;</span><span class="p">,</span>
    <span class="s1">&#39;months_before_tenancy_lease_expiry&#39;</span><span class="p">,</span>
    <span class="o">*</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">condo_X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> 
      <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()[:</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;facing&#39;</span><span class="p">)]</span> <span class="o">==</span> <span class="s1">&#39;facing&#39;</span> <span class="ow">or</span> 
      <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()[:</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;condition&#39;</span><span class="p">)]</span> <span class="o">==</span> <span class="s1">&#39;condition&#39;</span> <span class="ow">or</span> 
      <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()[:</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;floor&#39;</span><span class="p">)]</span> <span class="o">==</span> <span class="s1">&#39;floor&#39;</span> <span class="ow">or</span> 
      <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()[:</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;furnishing&#39;</span><span class="p">)]</span> <span class="o">==</span> <span class="s1">&#39;furnishing&#39;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">landed_specific_feats</span> <span class="o">+</span> <span class="n">special_feats</span> <span class="o">+</span> <span class="n">availability_feats</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="c1"># This still includes the price</span>
<span class="n">y_scaled</span> <span class="o">=</span> <span class="n">y_scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">condo_X</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="dimensionality-reduction">
<h3>Dimensionality Reduction<a class="headerlink" href="#dimensionality-reduction" title="Permalink to this headline">¶</a></h3>
<p>We do still have quite a few features even after dropping a bunch above, can we reduce them?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pca</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">X_pca</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">total_variance_explained</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_scaled</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>    
    <span class="n">pca</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="n">X_pca</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">pca</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">total_variance_explained</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pca</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total variance explained by </span><span class="si">{}</span><span class="s1"> components: </span><span class="si">{}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pca</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">explained_variance_ratio_</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)))</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">total_variance_explained</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of Principal Components&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Variance Explained (%)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Variance Explained (%) Vs Number of Principal Components&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total variance explained by 1 components: 37.44901012608501%
Total variance explained by 2 components: 50.52012742027444%
Total variance explained by 3 components: 58.2122032477493%
Total variance explained by 4 components: 63.71936324414935%
Total variance explained by 5 components: 68.10118454120607%
Total variance explained by 6 components: 72.09956046825472%
Total variance explained by 7 components: 75.78853575615108%
Total variance explained by 8 components: 79.1381882097906%
Total variance explained by 9 components: 82.17081188203308%
Total variance explained by 10 components: 85.17710652739778%
Total variance explained by 11 components: 87.69274718960978%
Total variance explained by 12 components: 89.96675917907427%
Total variance explained by 13 components: 92.13993991495079%
Total variance explained by 14 components: 93.70681147532277%
Total variance explained by 15 components: 95.06543260423634%
Total variance explained by 16 components: 96.26043798884034%
Total variance explained by 17 components: 97.35763917222253%
Total variance explained by 18 components: 98.24358160452519%
Total variance explained by 19 components: 99.04492402521927%
Total variance explained by 20 components: 99.4963397274083%
Total variance explained by 21 components: 99.74786690160937%
Total variance explained by 22 components: 99.93994057672074%
Total variance explained by 23 components: 99.99801217275599%
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_32_1.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_32_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scree_plot</span><span class="p">(</span><span class="n">pca</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function:</span>
<span class="sd">    ---------</span>
<span class="sd">    Creates a scree plot associated with the principal components </span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    pca: the result of instantiation of PCA in scikit learn</span>
<span class="sd">            </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">num_components</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">)</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_components</span><span class="p">)</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total variance explained by </span><span class="si">{}</span><span class="s1"> components: </span><span class="si">{}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_components</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
    
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>
    <span class="n">cumvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">cumvals</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_components</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">)[:</span><span class="mi">4</span><span class="p">])),</span> <span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
 
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
 
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Principal Component&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Variance Explained (%)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Explained Variance Per Principal Component&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
    
<span class="k">for</span> <span class="n">n_components</span><span class="p">,</span> <span class="n">pca_obj</span> <span class="ow">in</span> <span class="n">pca</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pca_obj</span><span class="o">.</span><span class="n">explained_variance_ratio_</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
        <span class="n">scree_plot</span><span class="p">(</span><span class="n">pca_obj</span><span class="p">)</span>
        <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total variance explained by 13 components: 92.13993991495077%
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_33_1.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_33_1.png" />
</div>
</div>
<p>Because we want more intepretability of the features we use for the subsequent analyses, we’ll use the original scaled features rather than any of the dimensionality reduced features using PCA. Furthermore, according to <a class="reference external" href="http://blog.explainmydata.com/2012/07/should-you-apply-pca-to-your-data.html">this</a>, PCA is highly sensitive to scale of the data, which makes me doubt whether we should really use PCA in this situation when we don’t have a well-justified reason to use it.</p>
<p><a id='model'></a></p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="modeling">
<h2>Modeling<a class="headerlink" href="#modeling" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cluster-analysis">
<h3>1. Cluster Analysis<a class="headerlink" href="#cluster-analysis" title="Permalink to this headline">¶</a></h3>
<p>Currently, there are <a class="reference external" href="https://www.singaporeexpats.com/housing-in-singapore/singapore-district-guide.htm">28 designated districts</a> in Singapore. After clustering our data, could we discern these 28 districts well, or is there a different clustering of the data?</p>
<p>We want to visualize the clusters created using the KMeans clustering algorithm which assigns data points to the cluster that the data point has the shortest euclidean distance to. Furthermore, since we have &gt;3 features, we’ll want to either visualize the clusters based on 2-3 features or like what we’ll  be doing below, visualize the first 2 TSNE embeddings of the features, helping us best preserve the relative “distance” between data points in a lower dimensional space.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">visualize_clusters</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">silhouette_avg</span><span class="p">,</span> <span class="n">cluster_labels</span><span class="p">,</span> <span class="n">clusterer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function:</span>
<span class="sd">    ---------</span>
<span class="sd">    Visualize the number of clusters predicted according to the model</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    X: The dataset to discover the clusters from</span>
<span class="sd">    silhouette_avg: The average silhouette score for all the samples</span>
<span class="sd">    cluster_labels: The predicted cluster labels by model</span>
<span class="sd">    clusterer: The fitted Kmeans model on X</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Compute the silhouette scores for each sample</span>
    <span class="n">sample_silhouette_values</span> <span class="o">=</span> <span class="n">silhouette_samples</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">cluster_labels</span><span class="p">)</span>
    
    <span class="c1"># Create a subplot with 1 row and 2 columns</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

    <span class="c1"># --------------------------------------------</span>
    <span class="c1"># The 1st subplot is the silhouette plot</span>
    <span class="c1"># The silhouette coefficient can range from -0.2, 1</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    
    <span class="c1"># The (n_clusters+1)*10 is for inserting blank space between silhouette</span>
    <span class="c1"># plots of individual clusters, to demarcate them clearly.</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">clusterer</span><span class="o">.</span><span class="n">n_clusters</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">])</span>

    <span class="n">y_lower</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">get_colors</span><span class="p">(</span><span class="n">clusterer</span><span class="o">.</span><span class="n">n_clusters</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">clusterer</span><span class="o">.</span><span class="n">n_clusters</span><span class="p">):</span>
        <span class="c1"># Aggregate the silhouette scores for samples belonging to</span>
        <span class="c1"># cluster i, and sort them</span>
        <span class="n">ith_cluster_silhouette_values</span> <span class="o">=</span> \
            <span class="n">sample_silhouette_values</span><span class="p">[</span><span class="n">cluster_labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span>

        <span class="n">ith_cluster_silhouette_values</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="n">size_cluster_i</span> <span class="o">=</span> <span class="n">ith_cluster_silhouette_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y_upper</span> <span class="o">=</span> <span class="n">y_lower</span> <span class="o">+</span> <span class="n">size_cluster_i</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">y_lower</span><span class="p">,</span> <span class="n">y_upper</span><span class="p">),</span>
                          <span class="mi">0</span><span class="p">,</span> <span class="n">ith_cluster_silhouette_values</span><span class="p">,</span>
                          <span class="n">facecolor</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

        <span class="c1"># Label the silhouette plots with their cluster numbers at the middle</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">y_lower</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">size_cluster_i</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

        <span class="c1"># Compute the new y_lower for next plot</span>
        <span class="n">y_lower</span> <span class="o">=</span> <span class="n">y_upper</span> <span class="o">+</span> <span class="mi">10</span>  <span class="c1"># 10 for the 0 samples</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;The silhouette plot for the various clusters.&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;The silhouette coefficient values&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Cluster label&quot;</span><span class="p">)</span>

    <span class="c1"># The vertical line for average silhouette score of all the values</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">silhouette_avg</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>  <span class="c1"># Clear the yaxis labels / ticks</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

    <span class="c1"># --------------------------------------------</span>
    <span class="c1"># 2nd Plot showing the actual clusters formed using TSNE embedding</span>
    <span class="n">labels_to_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">cluster_labels</span><span class="p">]</span>
    
    <span class="c1"># Create TSNE Embeddings</span>
    <span class="n">X_embedded</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    
    <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_embedded</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_embedded</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                <span class="n">c</span><span class="o">=</span><span class="n">labels_to_colors</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

    <span class="c1"># Labeling the clusters</span>
    <span class="c1"># Get the indices of the data points that are closest to the cluster centers </span>
    <span class="n">closest_data_points_indices</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pairwise_distances_argmin_min</span><span class="p">(</span><span class="n">clusterer</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
    <span class="n">closest_data_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">X_embedded</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">closest_data_points_indices</span><span class="p">])</span>
    
    <span class="c1"># Draw white circles at those approximate cluster centers</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">closest_data_points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">closest_data_points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                <span class="n">c</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">closest_data_points</span><span class="p">):</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;$</span><span class="si">%d</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;The visualization of the clustered data.&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Feature space for the 1st TSNE Embedding&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Feature space for the 2nd TSNE Embedding&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">((</span><span class="s2">&quot;Silhouette analysis for KMeans clustering on sample data &quot;</span>
                  <span class="s2">&quot;with n_clusters = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">clusterer</span><span class="o">.</span><span class="n">n_clusters</span><span class="p">),</span>
                 <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<p>But how will we choose the “optimal” number of clusters? We will be using 2 metrics:</p>
<ol class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/K-means_clustering">KMeans objective: The Within-Cluster Sum of Squares (WCSS) / Variance</a></p>
<ul class="simple">
<li><p>The pairwise squared deviations of points in the same cluster</p></li>
<li><p>If every data point is it’s own cluster, this metric will be 0</p></li>
</ul>
</li>
</ol>
<div class="math notranslate nohighlight">
\[
\underset{ \mathbf{S} }{ \operatorname{arg\,min} } \sum_{i=1}^{k} \sum_{ \mathbf{x} \in S_i} {\mid \mathbf{x} - \boldsymbol{\mu_i} \mid}^2 = \underset{ \mathbf{S} } {\operatorname{arg\,min} }\sum_{i=1}^k \mid S_i \mid \operatorname{Var} S_i, \text{ where } \mu_i \text{ is the mean of points in } S_i
\]</div>
<ol class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Silhouette_(clustering)">The Silhouette Score</a></p>
<ul class="simple">
<li><p>A measure of how similar an object is to its own cluster (cohesion) compared to other clusters (separation)</p></li>
</ul>
</li>
</ol>
<p>The goal for choosing the best number of clusters becomes a problem of trying to find the number of clusters that best maximizes the silhouette score, but yet minimizes the WCSS. This is what’s known as a multi-objective optimization problem (You can learn more about it <a class="reference external" href="https://engineering.purdue.edu/~sudhoff/ee630/Lecture09.pdf">here</a>). In multi-objective optimization problems, it’s very rare to find a single most optimal solution for the problem. Instead, we’ll find what is called a “Pareto Optimal Set / Pareto-efficient Frontier” which is a set of solutions that are not “dominated” by any others. “Not Dominated” intuitively meaning that a solution does not have any other solutions that are better than it in all objectives. Below, we have a written a function that does just this - determine the pareto frontier and plot it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_pareto_frontier</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">n_clusters</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">maxX</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">maxY</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function:</span>
<span class="sd">    ---------</span>
<span class="sd">    Plots the pareto frontier given costs X and Y for choosing</span>
<span class="sd">    number of clusters</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    X: list of WCSS scores for each of the number of clusters</span>
<span class="sd">    Y: list of Silhouette scores for each of the number of clusters</span>
<span class="sd">    n_clusters: list of number of clusters </span>
<span class="sd">    ax: axis to plot the pareto frontier</span>
<span class="sd">    maxX: Bool, True if we are trying to maximize X, false if minimize X</span>
<span class="sd">    maxY: Bool, True if we are trying to maximize Y, false if minimize Y</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    pareto_front: The pareto frontier tuples containing number</span>
<span class="sd">                  of clusters, wcss score, and silhouette score</span>
<span class="sd">                  (wcss score, silhouette score, n_clusters)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Start with all elements in pareto front,</span>
    <span class="c1"># then remove all the non-dominating elements in outer for loop</span>
    <span class="n">X_scaler</span><span class="p">,</span> <span class="n">Y_scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
    <span class="n">X_scaled</span><span class="p">,</span> <span class="n">Y_scaled</span> <span class="o">=</span> <span class="n">X_scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">Y_scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">pareto_front</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">,</span> <span class="n">Y_scaled</span><span class="p">,</span> <span class="n">n_clusters</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">val</span><span class="p">:</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="n">maxY</span><span class="p">)</span>

    <span class="c1"># idx - index of last added dominating element in our pareto front</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pareto_front</span><span class="p">)):</span>
        <span class="c1"># Remove all elements that have X larger than the last dominating element</span>
        <span class="c1"># of the pareto frontier</span>
        <span class="k">for</span> <span class="n">xy</span> <span class="ow">in</span> <span class="n">pareto_front</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="c1"># Maximize X</span>
            <span class="k">if</span> <span class="n">maxX</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pareto_front</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">pareto_front</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span>
            <span class="c1"># Minimize X</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pareto_front</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">pareto_front</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span>

        <span class="c1"># Now our search space has been confined to elements</span>
        <span class="c1"># that have a smaller X (good), but not so good Y,</span>
        <span class="c1"># so we can move to idx+1</span>
    
    <span class="sd">&#39;&#39;&#39;Plotting process&#39;&#39;&#39;</span>
    <span class="n">normalized_wcss_scores</span><span class="p">,</span> <span class="n">normalized_silhouette_avg_scores</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">pareto_front</span><span class="p">))[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">,</span> <span class="n">Y_scaled</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">normalized_wcss_scores</span><span class="p">,</span> <span class="n">normalized_silhouette_avg_scores</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Normalized WCSS (Minimization Objective)&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized Silhouette Score (Maximization Objective)&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Pareto Frontier&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="p">[(</span><span class="n">X_scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">normalized_wcss_score</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> 
             <span class="n">Y_scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">normalized_silhouette_avg_score</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> 
             <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">normalized_wcss_score</span><span class="p">,</span> <span class="n">normalized_silhouette_avg_score</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pareto_front</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>But how will we choose the “best” clustering from this reduced pareto-optimal set? For now, we’ll determine the “best” clustering using the silhouette scores of each data point - our objective is “out of all the clusterings in the pareto frontier, choose the clustering that best minimizes the mean squared error and mean absolute error of each data point’s silhouette score to the average silhouette score”. In simple terms, we just want clusterings that have individual sample silhouette scores that are more or less similar to everyone else’s.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_best_n_clusters</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">range_n_clusters</span><span class="p">,</span> <span class="n">actual_clusters</span><span class="p">,</span> <span class="n">property_links</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function:</span>
<span class="sd">    ---------</span>
<span class="sd">    Visualize the number of clusters predicted according to the model</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    X: The dataset to discover the clusters from</span>
<span class="sd">    range_n_clusters: list of the different number of clusters to fit Kmeans on</span>
<span class="sd">    actual_clusters: pandas series of the actual clusters designated by the Singapore government</span>
<span class="sd">    property_links: pandas series of the web urls for each condominium in our dataset</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    pandas dataframe with the cluster predictions for model with subjectively best WCSS and</span>
<span class="sd">    Silhouette score tradeoff on pareto frontier</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Silhouette scores for different number of clusters</span>
    <span class="n">silhouette_avg_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Inertia / Within-cluster Sum of Squares scores for different number of clusters</span>
    <span class="n">wcss_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Dictionary of the Kmeans models fitted on different number of clusters</span>
    <span class="n">clusterers</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Dictionary of the predicted cluster labels for each sample by the fitted Kmeans models</span>
    <span class="n">cluster_labels</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">n_clusters</span> <span class="ow">in</span> <span class="n">range_n_clusters</span><span class="p">:</span>

        <span class="c1"># Initialize the clusterer with n_clusters value and a random generator</span>
        <span class="c1"># seed of 10 for reproducibility.</span>
        <span class="n">clusterers</span><span class="p">[</span><span class="n">n_clusters</span><span class="p">]</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">n_clusters</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">cluster_labels</span><span class="p">[</span><span class="n">n_clusters</span><span class="p">]</span> <span class="o">=</span> <span class="n">clusterers</span><span class="p">[</span><span class="n">n_clusters</span><span class="p">]</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="c1"># The silhouette_score gives the average value for all the samples.</span>
        <span class="c1"># This gives a perspective into the density and separation of the formed</span>
        <span class="c1"># clusters</span>
        <span class="n">silhouette_avg</span> <span class="o">=</span> <span class="n">silhouette_score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">cluster_labels</span><span class="p">[</span><span class="n">n_clusters</span><span class="p">])</span>
        <span class="n">silhouette_avg_scores</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n_clusters</span><span class="p">,</span> <span class="n">silhouette_avg</span><span class="p">))</span>
        
        <span class="c1"># Save the WCSS</span>
        <span class="n">wcss_scores</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n_clusters</span><span class="p">,</span> <span class="n">clusterers</span><span class="p">[</span><span class="n">n_clusters</span><span class="p">]</span><span class="o">.</span><span class="n">inertia_</span><span class="p">))</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;For n_clusters=&quot;</span><span class="p">,</span> <span class="n">n_clusters</span><span class="p">,</span>
              <span class="s2">&quot; Average silhouette_score:&quot;</span><span class="p">,</span> <span class="n">silhouette_avg</span><span class="p">,</span> 
              <span class="s2">&quot; WCSS:&quot;</span><span class="p">,</span> <span class="n">clusterers</span><span class="p">[</span><span class="n">n_clusters</span><span class="p">]</span><span class="o">.</span><span class="n">inertia_</span><span class="p">)</span>
      
    <span class="c1"># Plot how the WCSS and silhouette scores change with n_clusters</span>
    <span class="c1"># Create a subplot with 1 row and 2 columns</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    
    <span class="c1"># 1st: Plot silhouette scores</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">silhouette_avg_scores</span><span class="p">)),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Silhouette Score&#39;</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Silhouette Score vs. K&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    
    <span class="c1"># 2nd: Plot wcss scores</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">wcss_scores</span><span class="p">)),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">get_colors</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">);</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;WCSS&#39;</span><span class="p">);</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;WCSS vs. K&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    
    <span class="c1"># 3rd: Plot Pareto frontier for multiobjective optimization</span>
    <span class="c1"># Minimize WCSS while Maximizing Silhouette score</span>
    <span class="n">pareto_front</span> <span class="o">=</span> <span class="n">plot_pareto_frontier</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">wcss_scores</span><span class="p">))[</span><span class="mi">1</span><span class="p">],</span> 
                                        <span class="n">Y</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">silhouette_avg_scores</span><span class="p">))[</span><span class="mi">1</span><span class="p">],</span> 
                                        <span class="n">n_clusters</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">wcss_scores</span><span class="p">))[</span><span class="mi">0</span><span class="p">],</span> 
                                        <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> 
                                        <span class="n">maxX</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                        <span class="n">maxY</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">((</span><span class="s1">&#39;Scoring metrics against Number of clusters fitted, K&#39;</span><span class="p">),</span>
                 <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
    
    <span class="c1"># Visualize the clusters for model with the </span>
    <span class="c1"># silhouette score and wcss score on pareto frontier</span>
    <span class="c1"># Select the number of clusters that best minimize the</span>
    <span class="c1"># mean squared error and mean absolute error of </span>
    <span class="c1"># silhouette scores of each sample with the average silhouette score</span>
    <span class="n">best_k</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_mse</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
    <span class="k">for</span> <span class="n">wcss_score</span><span class="p">,</span> <span class="n">silhouette_avg</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pareto_front</span><span class="p">:</span> 
        <span class="c1"># Compute the silhouette scores for each sample</span>
        <span class="n">sample_silhouette_values</span> <span class="o">=</span> <span class="n">silhouette_samples</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">cluster_labels</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">cluster_mse</span><span class="p">,</span> <span class="n">cluster_mae</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">sample_silhouette_values</span><span class="p">[</span><span class="n">cluster_labels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">],</span> <span class="n">silhouette_avg</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> 
                                               <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">sample_silhouette_values</span><span class="p">[</span><span class="n">cluster_labels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">],</span> <span class="n">silhouette_avg</span><span class="p">))))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">)]))</span>
        <span class="n">total_mse</span><span class="p">,</span> <span class="n">total_mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cluster_mse</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cluster_mae</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span>
              <span class="s1">&#39;MSE:&#39;</span><span class="p">,</span> <span class="n">total_mse</span><span class="p">,</span>
              <span class="s1">&#39;MAE:&#39;</span><span class="p">,</span> <span class="n">total_mae</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">best_mse</span> <span class="o">&gt;</span> <span class="n">total_mse</span> <span class="ow">and</span> <span class="n">best_mae</span> <span class="o">&gt;</span> <span class="n">total_mae</span> <span class="ow">and</span> <span class="n">silhouette_avg</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">best_k</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_mse</span> <span class="o">=</span> <span class="n">k</span><span class="p">,</span> <span class="n">total_mae</span><span class="p">,</span> <span class="n">total_mse</span>
            
    <span class="n">visualize_clusters</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">silhouette_avg</span><span class="p">,</span> <span class="n">cluster_labels</span><span class="p">[</span><span class="n">best_k</span><span class="p">],</span> <span class="n">clusterers</span><span class="p">[</span><span class="n">best_k</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pc_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)]),</span> 
        <span class="n">actual_clusters</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> 
        <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">cluster_labels</span><span class="p">[</span><span class="n">best_k</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;pred_cluster&#39;</span><span class="p">),</span>
        <span class="n">property_links</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">range_n_clusters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cluster Analysis with selected scaled raw features of each condominium&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;-&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;-&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)]))</span>
<span class="n">clustered_df</span> <span class="o">=</span> <span class="n">find_best_n_clusters</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">,</span> <span class="n">range_n_clusters</span><span class="p">,</span> <span class="n">condo_X</span><span class="p">[</span><span class="s1">&#39;District&#39;</span><span class="p">],</span> <span class="n">condo_X</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cluster Analysis with selected scaled raw features of each condominium
--------------------------------------------------
--------------------------------------------------
For n_clusters= 2  Average silhouette_score: 0.3549972906518493  WCSS: 105137.50727576688
For n_clusters= 3  Average silhouette_score: 0.2411975205930827  WCSS: 90997.57615879267
For n_clusters= 4  Average silhouette_score: 0.24954355674479473  WCSS: 85226.07668492352
For n_clusters= 5  Average silhouette_score: 0.23013095818941526  WCSS: 80151.31782820313
For n_clusters= 6  Average silhouette_score: 0.22886253996933206  WCSS: 75324.3209739146
For n_clusters= 7  Average silhouette_score: 0.23012537957319412  WCSS: 70741.85635861049
For n_clusters= 8  Average silhouette_score: 0.2304048303672874  WCSS: 67573.49802118186
For n_clusters= 9  Average silhouette_score: 0.18111757089998443  WCSS: 64560.15727866402
For n_clusters= 10  Average silhouette_score: 0.18986759762627758  WCSS: 61833.97083530403
For n_clusters= 11  Average silhouette_score: 0.1828429922893222  WCSS: 60008.027663087436
For n_clusters= 12  Average silhouette_score: 0.20410039952285397  WCSS: 58511.76054904609
For n_clusters= 13  Average silhouette_score: 0.1896192557930811  WCSS: 56853.41129565918
For n_clusters= 14  Average silhouette_score: 0.18768967342704124  WCSS: 55390.64851749043
For n_clusters= 15  Average silhouette_score: 0.19574955326403243  WCSS: 54130.91063009418
For n_clusters= 16  Average silhouette_score: 0.19934962340870374  WCSS: 52428.88564664509
For n_clusters= 17  Average silhouette_score: 0.20227427136763368  WCSS: 51700.363755510436
For n_clusters= 18  Average silhouette_score: 0.19850491936624248  WCSS: 49868.53613329161
For n_clusters= 19  Average silhouette_score: 0.21023452047629868  WCSS: 49142.94635668766
For n_clusters= 20  Average silhouette_score: 0.19870000629026413  WCSS: 48338.4251475733
For n_clusters= 21  Average silhouette_score: 0.20654454442365563  WCSS: 46835.82811771525
For n_clusters= 22  Average silhouette_score: 0.2058662178986638  WCSS: 46348.661137542316
For n_clusters= 23  Average silhouette_score: 0.1990596493469914  WCSS: 45709.20987946383
For n_clusters= 24  Average silhouette_score: 0.2141592397265323  WCSS: 44731.70719902063
For n_clusters= 25  Average silhouette_score: 0.207115558373843  WCSS: 44067.72371306498
For n_clusters= 26  Average silhouette_score: 0.21784658499719767  WCSS: 43433.11899934155
For n_clusters= 27  Average silhouette_score: 0.2126622155963869  WCSS: 43274.69893891207
For n_clusters= 28  Average silhouette_score: 0.20674320076752736  WCSS: 42605.64007728472
For n_clusters= 29  Average silhouette_score: 0.21258005498397756  WCSS: 41841.55585258599
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_43_1.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_43_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>k: 2 MSE: 0.029432588124124182 MAE: 0.1419059891293578
k: 4 MSE: 0.03360509329087829 MAE: 0.14578550140952135
k: 8 MSE: 0.030116199066125872 MAE: 0.14257165603216454
k: 26 MSE: 0.03776506483417667 MAE: 0.15482947653698487
k: 27 MSE: 0.027292233532538155 MAE: 0.1310073747753424
k: 29 MSE: 0.030750226150408833 MAE: 0.13793852254050484
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_43_3.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_43_3.png" />
</div>
</div>
<p>We observe that in the “WCSS Vs. K” plot, there isn’t a directly obvious “elbow” in the graph, making it hard for us to use the “elbow” method in order to determine the best number of clusters for our data, which is why we chose to complement the decision with silhouette scores too. Number of clusters <span class="math notranslate nohighlight">\(k=2, 4, 5, 8, 9, 29\)</span> all lie on the pareto frontier making them candidates for the best number of clusters. However, according to the MSE and MAE silhouette scores, <span class="math notranslate nohighlight">\(k=2\)</span> still performs the best, which is why we chose to use it in the end.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">top_k_districts</span><span class="p">(</span><span class="n">condo_cluster</span><span class="p">,</span> <span class="n">condo_counts_by_district</span><span class="p">,</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function:</span>
<span class="sd">    ---------</span>
<span class="sd">    Prints the top K highest frequency districts obtained from</span>
<span class="sd">    our cluster analysis</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    condo_cluster: pandas series of index as the districts in singapore and values </span>
<span class="sd">                   as the frequency of that district in the cluster predicted by the model</span>
<span class="sd">    condo_counts_by_district: pandas series of the counts of each district </span>
<span class="sd">    cluster: the predicted cluster (int)</span>
<span class="sd">    k: top k highest frequency districts as a percentage of the total number of </span>
<span class="sd">       samples of each district we have in predicted cluster</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">top_k_districts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">district</span><span class="p">,</span> <span class="n">sg_districts</span><span class="p">[</span><span class="n">district</span><span class="p">])</span> <span class="k">for</span> <span class="n">district</span> <span class="ow">in</span> <span class="n">condo_cluster</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">condo_counts_by_district</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[</span><span class="o">-</span><span class="n">k</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Top </span><span class="si">{}</span><span class="s1"> districts associated with Predicted Cluster </span><span class="si">{}</span><span class="s1">:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">cluster</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;-&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)]))</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">district</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">top_k_districts</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">. </span><span class="si">{}</span><span class="s1"> -&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">district</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">district</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">district</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">cluster_district_breakdown</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">condo_X</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function:</span>
<span class="sd">    ---------</span>
<span class="sd">    Plots the breakdown of frequency of each singapore district inside the predicted cluster</span>
<span class="sd">    and overlayed over the total frequency of each district in the context of condominiums</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    df: pandas dataframe returned from find_best_n_clusters</span>
<span class="sd">    condo_X: the original raw dataframe with just condos</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;-&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;-&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)]))</span>
    
    <span class="c1"># Plot the breakdown of district frequency for each cluster</span>
    <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">pred_cluster</span><span class="o">.</span><span class="n">nunique</span><span class="p">()):</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

        <span class="c1"># Plot the breakdown of total condos per district that we have in </span>
        <span class="c1"># our dataset</span>
        <span class="n">condo_counts_by_district</span> <span class="o">=</span> <span class="n">condo_X</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;District&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="o">*</span><span class="n">districts</span><span class="p">],</span> <span class="s1">&#39;price&#39;</span><span class="p">]</span>
        <span class="n">condo_counts_by_district</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">condo_counts_by_district</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="n">condo_counts_by_district</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> 
            <span class="n">color</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">val</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">get_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">condo_counts_by_district</span><span class="p">)))),</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
        <span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        
        <span class="c1"># Plot the district counts for a predicted cluster</span>
        <span class="n">condo_cluster_counts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pred_cluster&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">cluster</span><span class="p">)][</span><span class="s1">&#39;District&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
        <span class="n">condo_cluster</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">condo_cluster_counts</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">condo_counts_by_district</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">condo_cluster</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> 
            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;District Frequency for Condominiums in Predicted Cluster </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cluster</span><span class="p">),</span> 
            <span class="n">color</span><span class="o">=</span><span class="n">get_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">condo_cluster</span><span class="p">)),</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
        <span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_height</span><span class="p">()),</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span><span class="o">+</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span><span class="o">+</span><span class="mi">10</span><span class="p">),</span> 
                        <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> 
                        <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="n">top_k_districts</span><span class="p">(</span><span class="n">condo_cluster</span><span class="p">,</span> <span class="n">condo_counts_by_district</span><span class="p">,</span> <span class="n">cluster</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;-&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;-&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)]))</span>
        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cluster_district_breakdown</span><span class="p">(</span><span class="n">clustered_df</span><span class="p">,</span> <span class="n">condo_X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_1.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 0:
--------------------------------------------------
1. 19 - North East - Hougang, Punggol, Sengkang
2. 17 - Far East - Changi, Loyang, Pasir Ris
3. 18 - Far East - Pasir Ris, Simei, Tampines
4. 14 - Central East - Eunos, Geylang, Kembangan, Paya Lebar
5. 20 - Central North - Ang Mo Kio, Bishan, Braddell Road, Thomson
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_3.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 1:
--------------------------------------------------
1. 9 - Central Orchard - Cairnhill, Killiney, Leonie Hill, Orchard, Oxley
2. 12 - Central - Balestier, Moulmein, Novena, Toa Payoh
3. 2 - City Business District - Anson Road, Chinatown, Neil Road, Raffles Place, Shenton Way, Tanjong Pagar
4. 8 - Central - Little India, Farrer Park, Serangoon Road
5. 10 - Central Near Orchard - Balmoral, Bukit Timah, Grange Road, Holland, Orchard Boulevard, River Valley, Tanglin Road
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_5.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 2:
--------------------------------------------------
1. 27 - Far North - Admiralty, Sembawang, Yishun
2. 18 - Far East - Pasir Ris, Simei, Tampines
3. 16 - Upper East Coast - Bayshore, Bedok, Chai Chee
4. 20 - Central North - Ang Mo Kio, Bishan, Braddell Road, Thomson
5. 17 - Far East - Changi, Loyang, Pasir Ris
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_7.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_7.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 3:
--------------------------------------------------
1. 13 - Central East - Potong Pasir, Machpherson
2. 9 - Central Orchard - Cairnhill, Killiney, Leonie Hill, Orchard, Oxley
3. 3 - Central South - Alexandra Road, Tiong Bahru, Queenstown
4. 10 - Central Near Orchard - Balmoral, Bukit Timah, Grange Road, Holland, Orchard Boulevard, River Valley, Tanglin Road
5. 7 - City - Beach Road, Bencoolen Road, Bugis, Rochor
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_9.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 4:
--------------------------------------------------
1. 4 - South - Keppel, Mount Faber, Sentosa, Telok Blangah
2. 10 - Central Near Orchard - Balmoral, Bukit Timah, Grange Road, Holland, Orchard Boulevard, River Valley, Tanglin Road
3. 15 - East Coast - Katong, Marine Parade, Siglap, Tanjong Rhu
4. 28 - North East - Seletar, Yio Chu Kang
5. 13 - Central East - Potong Pasir, Machpherson
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_11.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_11.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 5:
--------------------------------------------------
1. 6 - City Business District - City Hall, High Street, North Bridge Road
2. 10 - Central Near Orchard - Balmoral, Bukit Timah, Grange Road, Holland, Orchard Boulevard, River Valley, Tanglin Road
3. 9 - Central Orchard - Cairnhill, Killiney, Leonie Hill, Orchard, Oxley
4. 11 - Central Near Orchard - Chancery, Bukit Timah, Dunearn Road, Newton
5. 4 - South - Keppel, Mount Faber, Sentosa, Telok Blangah
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_13.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_13.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 6:
--------------------------------------------------
1. 19 - North East - Hougang, Punggol, Sengkang
2. 23 - North West - Bukit Batok, Choa Chu Kang, Hillview Avenue, Upper Bukit Timah
3. 28 - North East - Seletar, Yio Chu Kang
4. 12 - Central - Balestier, Moulmein, Novena, Toa Payoh
5. 2 - City Business District - Anson Road, Chinatown, Neil Road, Raffles Place, Shenton Way, Tanjong Pagar
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_15.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_15.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 7:
--------------------------------------------------
1. 13 - Central East - Potong Pasir, Machpherson
2. 12 - Central - Balestier, Moulmein, Novena, Toa Payoh
3. 11 - Central Near Orchard - Chancery, Bukit Timah, Dunearn Road, Newton
4. 5 - South West - Buona Vista, Dover, Pasir Panjang, West Coast
5. 10 - Central Near Orchard - Balmoral, Bukit Timah, Grange Road, Holland, Orchard Boulevard, River Valley, Tanglin Road
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_17.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_17.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 8:
--------------------------------------------------
1. 8 - Central - Little India, Farrer Park, Serangoon Road
2. 11 - Central Near Orchard - Chancery, Bukit Timah, Dunearn Road, Newton
3. 14 - Central East - Eunos, Geylang, Kembangan, Paya Lebar
4. 9 - Central Orchard - Cairnhill, Killiney, Leonie Hill, Orchard, Oxley
5. 12 - Central - Balestier, Moulmein, Novena, Toa Payoh
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_19.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_19.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 9:
--------------------------------------------------
1. 28 - North East - Seletar, Yio Chu Kang
2. 19 - North East - Hougang, Punggol, Sengkang
3. 27 - Far North - Admiralty, Sembawang, Yishun
4. 13 - Central East - Potong Pasir, Machpherson
5. 14 - Central East - Eunos, Geylang, Kembangan, Paya Lebar
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_21.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_21.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 10:
--------------------------------------------------
1. 1 - City Business District - Boat Quay, Chinatown, Havelock Road, Marina Square, Raffles Place, Suntec City
2. 7 - City - Beach Road, Bencoolen Road, Bugis, Rochor
3. 2 - City Business District - Anson Road, Chinatown, Neil Road, Raffles Place, Shenton Way, Tanjong Pagar
4. 4 - South - Keppel, Mount Faber, Sentosa, Telok Blangah
5. 8 - Central - Little India, Farrer Park, Serangoon Road
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_23.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_23.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 11:
--------------------------------------------------
1. 10 - Central Near Orchard - Balmoral, Bukit Timah, Grange Road, Holland, Orchard Boulevard, River Valley, Tanglin Road
2. 2 - City Business District - Anson Road, Chinatown, Neil Road, Raffles Place, Shenton Way, Tanjong Pagar
3. 11 - Central Near Orchard - Chancery, Bukit Timah, Dunearn Road, Newton
4. 15 - East Coast - Katong, Marine Parade, Siglap, Tanjong Rhu
5. 14 - Central East - Eunos, Geylang, Kembangan, Paya Lebar
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_25.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_25.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 12:
--------------------------------------------------
1. 21 - Central West - Clementi, Upper Bukit Timah, Hume Avenue
2. 26 - North - Tagore, Yio Chu Kang
3. 5 - South West - Buona Vista, Dover, Pasir Panjang, West Coast
4. 13 - Central East - Potong Pasir, Machpherson
5. 19 - North East - Hougang, Punggol, Sengkang
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_27.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_27.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 13:
--------------------------------------------------
1. 3 - Central South - Alexandra Road, Tiong Bahru, Queenstown
2. 12 - Central - Balestier, Moulmein, Novena, Toa Payoh
3. 5 - South West - Buona Vista, Dover, Pasir Panjang, West Coast
4. 10 - Central Near Orchard - Balmoral, Bukit Timah, Grange Road, Holland, Orchard Boulevard, River Valley, Tanglin Road
5. 23 - North West - Bukit Batok, Choa Chu Kang, Hillview Avenue, Upper Bukit Timah
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_29.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_29.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 14:
--------------------------------------------------
1. 15 - East Coast - Katong, Marine Parade, Siglap, Tanjong Rhu
2. 14 - Central East - Eunos, Geylang, Kembangan, Paya Lebar
3. 19 - North East - Hougang, Punggol, Sengkang
4. 21 - Central West - Clementi, Upper Bukit Timah, Hume Avenue
5. 11 - Central Near Orchard - Chancery, Bukit Timah, Dunearn Road, Newton
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_31.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_31.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 15:
--------------------------------------------------
1. 26 - North - Tagore, Yio Chu Kang
2. 5 - South West - Buona Vista, Dover, Pasir Panjang, West Coast
3. 23 - North West - Bukit Batok, Choa Chu Kang, Hillview Avenue, Upper Bukit Timah
4. 21 - Central West - Clementi, Upper Bukit Timah, Hume Avenue
5. 27 - Far North - Admiralty, Sembawang, Yishun
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_33.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_33.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 16:
--------------------------------------------------
1. 18 - Far East - Pasir Ris, Simei, Tampines
2. 17 - Far East - Changi, Loyang, Pasir Ris
3. 25 - Far North - Admiralty, Woodlands
4. 27 - Far North - Admiralty, Sembawang, Yishun
5. 19 - North East - Hougang, Punggol, Sengkang
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_35.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_35.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 17:
--------------------------------------------------
1. 25 - Far North - Admiralty, Woodlands
2. 22 - Far West - Boon Lay, Jurong, Tuas
3. 27 - Far North - Admiralty, Sembawang, Yishun
4. 23 - North West - Bukit Batok, Choa Chu Kang, Hillview Avenue, Upper Bukit Timah
5. 17 - Far East - Changi, Loyang, Pasir Ris
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_37.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_37.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 18:
--------------------------------------------------
1. 16 - Upper East Coast - Bayshore, Bedok, Chai Chee
2. 20 - Central North - Ang Mo Kio, Bishan, Braddell Road, Thomson
3. 3 - Central South - Alexandra Road, Tiong Bahru, Queenstown
4. 12 - Central - Balestier, Moulmein, Novena, Toa Payoh
5. 14 - Central East - Eunos, Geylang, Kembangan, Paya Lebar
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_39.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_39.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 19:
--------------------------------------------------
1. 4 - South - Keppel, Mount Faber, Sentosa, Telok Blangah
2. 11 - Central Near Orchard - Chancery, Bukit Timah, Dunearn Road, Newton
3. 28 - North East - Seletar, Yio Chu Kang
4. 13 - Central East - Potong Pasir, Machpherson
5. 2 - City Business District - Anson Road, Chinatown, Neil Road, Raffles Place, Shenton Way, Tanjong Pagar
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_41.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_41.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 20:
--------------------------------------------------
1. 17 - Far East - Changi, Loyang, Pasir Ris
2. 16 - Upper East Coast - Bayshore, Bedok, Chai Chee
3. 15 - East Coast - Katong, Marine Parade, Siglap, Tanjong Rhu
4. 18 - Far East - Pasir Ris, Simei, Tampines
5. 27 - Far North - Admiralty, Sembawang, Yishun
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_43.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_43.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 21:
--------------------------------------------------
1. 25 - Far North - Admiralty, Woodlands
2. 22 - Far West - Boon Lay, Jurong, Tuas
3. 23 - North West - Bukit Batok, Choa Chu Kang, Hillview Avenue, Upper Bukit Timah
4. 18 - Far East - Pasir Ris, Simei, Tampines
5. 27 - Far North - Admiralty, Sembawang, Yishun
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_45.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_45.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 22:
--------------------------------------------------
1. 6 - City Business District - City Hall, High Street, North Bridge Road
2. 10 - Central Near Orchard - Balmoral, Bukit Timah, Grange Road, Holland, Orchard Boulevard, River Valley, Tanglin Road
3. 1 - City Business District - Boat Quay, Chinatown, Havelock Road, Marina Square, Raffles Place, Suntec City
4. 7 - City - Beach Road, Bencoolen Road, Bugis, Rochor
5. 4 - South - Keppel, Mount Faber, Sentosa, Telok Blangah
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_47.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_47.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 23:
--------------------------------------------------
1. 22 - Far West - Boon Lay, Jurong, Tuas
2. 23 - North West - Bukit Batok, Choa Chu Kang, Hillview Avenue, Upper Bukit Timah
3. 5 - South West - Buona Vista, Dover, Pasir Panjang, West Coast
4. 27 - Far North - Admiralty, Sembawang, Yishun
5. 21 - Central West - Clementi, Upper Bukit Timah, Hume Avenue
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_49.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_49.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 24:
--------------------------------------------------
1. 20 - Central North - Ang Mo Kio, Bishan, Braddell Road, Thomson
2. 3 - Central South - Alexandra Road, Tiong Bahru, Queenstown
3. 14 - Central East - Eunos, Geylang, Kembangan, Paya Lebar
4. 5 - South West - Buona Vista, Dover, Pasir Panjang, West Coast
5. 15 - East Coast - Katong, Marine Parade, Siglap, Tanjong Rhu
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_51.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_51.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 25:
--------------------------------------------------
1. 15 - East Coast - Katong, Marine Parade, Siglap, Tanjong Rhu
2. 21 - Central West - Clementi, Upper Bukit Timah, Hume Avenue
3. 14 - Central East - Eunos, Geylang, Kembangan, Paya Lebar
4. 26 - North - Tagore, Yio Chu Kang
5. 10 - Central Near Orchard - Balmoral, Bukit Timah, Grange Road, Holland, Orchard Boulevard, River Valley, Tanglin Road
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_53.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_46_53.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5 districts associated with Predicted Cluster 26:
--------------------------------------------------
1. 18 - Far East - Pasir Ris, Simei, Tampines
2. 27 - Far North - Admiralty, Sembawang, Yishun
3. 28 - North East - Seletar, Yio Chu Kang
4. 26 - North - Tagore, Yio Chu Kang
5. 14 - Central East - Eunos, Geylang, Kembangan, Paya Lebar
--------------------------------------------------
--------------------------------------------------
</pre></div>
</div>
</div>
</div>
<p>Coincidentally, we got <span class="math notranslate nohighlight">\(k=27\)</span> as the best number of clusters for our data, very close to the 28 districts in Singapore. However, our clusters arent exactly like the ones in the 28 districts as virtually all the 27 clusters overlap various districts, not just a cluster for  each district. Although, the clusters do not seem too random and do appear to cluster some apartments quite logically. As you can see, Cluster 0 covers mostly Far East apartments, Clusters 1 and 8 covers mostly central apartments, Clusters 15 and  17 cover mostly North-west apartments, and Clusters 20 and 26 cover mostly Far-east / Far-north apartments.</p>
</div>
<div class="section" id="feature-importance-regression-analysis">
<h3>2. Feature Importance / Regression Analysis<a class="headerlink" href="#feature-importance-regression-analysis" title="Permalink to this headline">¶</a></h3>
<p>Out of the physical features of the property we have gathered in our dataset, are there any that are most helpful in predicting the price of the house?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize a Random forest regressor</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1"># Fit the Cross validated estimators</span>
<span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">rf</span><span class="p">,</span> 
    <span class="n">X</span><span class="o">=</span><span class="n">X_scaled</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> 
    <span class="n">y</span><span class="o">=</span><span class="n">y_scaled</span><span class="p">,</span> 
    <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> <span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">],</span> 
    <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">return_estimator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the cross-validated scores</span>
<span class="n">cv_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">cv_results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">cv_results</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">3</span><span class="p">:]})</span>
<span class="n">cv_scores</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>test_r2</th>
      <th>test_neg_mean_absolute_error</th>
      <th>test_neg_mean_squared_error</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.853401</td>
      <td>-0.097930</td>
      <td>-0.124370</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.865073</td>
      <td>-0.108507</td>
      <td>-0.177327</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.903024</td>
      <td>-0.104813</td>
      <td>-0.106353</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.893775</td>
      <td>-0.095055</td>
      <td>-0.076311</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.878629</td>
      <td>-0.107987</td>
      <td>-0.123859</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mean Scores across each Random Forest Regressor</span>
<span class="n">cv_scores_mean</span> <span class="o">=</span> <span class="n">cv_scores</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cv_scores_mean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>test_r2                         0.878781
test_neg_mean_absolute_error   -0.102859
test_neg_mean_squared_error    -0.121644
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rescaled_mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">y_scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">([</span><span class="o">-</span><span class="n">cv_scores_mean</span><span class="p">[</span><span class="s1">&#39;test_neg_mean_absolute_error&#39;</span><span class="p">]])[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">rescaled_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">y_scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">([(</span><span class="o">-</span><span class="n">cv_scores_mean</span><span class="p">[</span><span class="s1">&#39;test_neg_mean_squared_error&#39;</span><span class="p">])</span><span class="o">**</span><span class="mf">0.5</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rescaled MAE: $</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rescaled_mae</span><span class="p">),</span> <span class="s1">&#39;Rescaled RMSE: $</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rescaled_rmse</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Rescaled MAE: $2267644.54 Rescaled RMSE: $2845858.46
</pre></div>
</div>
</div>
</div>
<p>After fitting Random Forest with <span class="math notranslate nohighlight">\(5\)</span>-fold cross validation, we seem to get pretty good <span class="math notranslate nohighlight">\(r^2\)</span> and low MAE and MSE scores. However, once we rescale them back, it appears that we’re mispredicting the prices on the scale of millions which is pretty bad. We’ll improve that next time, but now let’s take a closer look at which features were most important for the price predictions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">k_feature_plot</span><span class="p">(</span><span class="n">importances</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Function:</span>
<span class="sd">    ---------</span>
<span class="sd">    Plots the k most important features</span>
<span class="sd">    given a feature_importance_ from an sklearn model</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    importances: The feature_importances_ from a sklearn model that supports it</span>
<span class="sd">    columns: The feature names of those that were used in fitting the model</span>
<span class="sd">    idx: The index of estimator</span>
<span class="sd">    ax: The axis to plot the figure on</span>
<span class="sd">    k: The top k features that were important in the prediction</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Display the five most important features</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">importances</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">indices</span><span class="p">[:</span><span class="n">k</span><span class="p">]]</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">importances</span><span class="p">[</span><span class="n">indices</span><span class="p">][:</span><span class="n">k</span><span class="p">]</span>

    <span class="c1"># Creat the plot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Normalized Weights for First Five Most Predictive Features of RandomForestRegressor </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">values</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#00A000&#39;</span><span class="p">,</span> \
           <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Feature Weight&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">align</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#00A0A0&#39;</span><span class="p">,</span> \
           <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Cumulative Feature Weight&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Weight&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Feature&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the feature importance for each regressor</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;estimator&#39;</span><span class="p">]):</span>
    <span class="n">k_feature_plot</span><span class="p">(</span><span class="n">estimator</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> 
                   <span class="n">X_scaled</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> 
                   <span class="n">idx</span><span class="p">,</span>
                   <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_55_0.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_55_0.png" />
</div>
</div>
<p>We will be using the built-in <code class="docutils literal notranslate"><span class="pre">feature_importance_</span></code> attribute of most sklearn Tree models - how the feature importance is calculated can be better understood <a class="reference external" href="https://alexisperrier.com/datascience/2015/08/27/feature-importance-random-forests-gini-accuracy.html">here</a>, noting that RandomForestRegressor implements <em>Gini importance</em> or in layman terms, how important a feature is will be proportionate  to the number of times it is used in making a split in building the Decision Tree. It appears the <code class="docutils literal notranslate"><span class="pre">sqft</span></code> is the most important feature so far in making a prediction of the house  price, making intuitive sense since larger houses tend to command a higher price. Next up would be the <code class="docutils literal notranslate"><span class="pre">transit_duration_to_orchard_road</span></code>. This makes perfect sense since the apartments located in the prime shopping district in Singapore (Orchard Road) are known to be more luxurious and command a higher price for its accessibility. Following would be either <code class="docutils literal notranslate"><span class="pre">num_supermarkets_nearby</span></code> (Measure of Accessibility), <code class="docutils literal notranslate"><span class="pre">transit_duration_to_raffles_place</span></code> (Another Measure of Accessibility), or <code class="docutils literal notranslate"><span class="pre">total_units</span></code> (Density of the neighbourhood).</p>
</div>
<div class="section" id="popularity">
<h3>3. Popularity<a class="headerlink" href="#popularity" title="Permalink to this headline">¶</a></h3>
<p>What are the “hottest” properties now, especially in the District 9, 10, 11 area (Primary Shopping district)?</p>
<p>I’m by far no expert on properties. However, I have heard that how “valuable” a piece of property is can be approximiately attributed to how much land is owned by the property development, so that’s the first step we’re going to do - find the size of land owned by each of the District 9, 10, and 11 property developments. Afterwards, we’ll gather a few of the property developments that own the largest land plots and check out which of them are the most popular recently.</p>
<p>Below we have a few functions dedicated to retrieving the Tranfaction history of the condominiums in districts 9, 10, 11.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TransactionHistory</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Purpose:</span>
<span class="sd">    --------</span>
<span class="sd">    To act as a placeholder for a class&#39; transaction history related</span>
<span class="sd">    data</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    cluster_id: A str containing the cluster_id of the specific condominium</span>
<span class="sd">    rent_df: A pandas dataframe of the rental transaction history returned by get_transact_history</span>
<span class="sd">    sale_df: A pandas dataframe of the sale transaction history returned by get_transact_history</span>
<span class="sd">    price_trends_dict: Dictionary of the price trend features returned by get_price_trends</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">cluster_id</span><span class="p">,</span> 
                 <span class="n">rent_df</span><span class="p">,</span> <span class="n">sale_df</span><span class="p">,</span> <span class="n">price_trends_dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cluster_id</span> <span class="o">=</span> <span class="n">cluster_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rent</span> <span class="o">=</span> <span class="n">rent_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sale</span> <span class="o">=</span> <span class="n">sale_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">price_trends</span> <span class="o">=</span> <span class="n">price_trends_dict</span>

<span class="k">def</span> <span class="nf">save_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function:</span>
<span class="sd">    ---------</span>
<span class="sd">    Pickles an object (Class definition still required to unpickle the object)</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    obj: object to be pickled</span>
<span class="sd">    filename: file to save the object to</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>  <span class="c1"># Overwrites any existing file.</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_transactions</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">districts</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function:</span>
<span class="sd">    ---------</span>
<span class="sd">    To retrieve the transaction history related data for all </span>
<span class="sd">    districts interested and save them to a json file</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    X: The dataframe containing the condo features with links to property page and district label</span>
<span class="sd">    districts: A list of the districts of interest in int</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    Returns a dictionary of key: cluster_id, val: TransactionHistory object containing </span>
<span class="sd">    data related to the property and also saves the data to a json file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The transaction history dictionary that will keep </span>
    <span class="c1"># all the data</span>
    <span class="n">transaction_history</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">districts</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">condo_url</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;District&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;D</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">)][</span><span class="s1">&#39;link&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
                <span class="n">cluster_id</span> <span class="o">=</span> <span class="n">get_cluster_id</span><span class="p">(</span><span class="n">condo_url</span><span class="p">)</span> <span class="c1"># Retrieve cluster id from property page</span>
                <span class="k">if</span> <span class="n">cluster_id</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Create TransactionHistory object with the data</span>
                    <span class="n">transaction_history</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">TransactionHistory</span><span class="p">(</span>
                        <span class="n">url</span><span class="o">=</span><span class="n">condo_url</span><span class="p">,</span>
                        <span class="n">cluster_id</span><span class="o">=</span><span class="n">cluster_id</span><span class="p">,</span>
                        <span class="n">rent_df</span><span class="o">=</span><span class="n">get_transact_history</span><span class="p">(</span><span class="n">cluster_id</span><span class="o">=</span><span class="n">cluster_id</span><span class="p">,</span> 
                                                     <span class="n">transaction_type</span><span class="o">=</span><span class="s1">&#39;rent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;Date&#39;</span><span class="p">]),</span>
                        <span class="n">sale_df</span><span class="o">=</span><span class="n">get_transact_history</span><span class="p">(</span><span class="n">cluster_id</span><span class="o">=</span><span class="n">cluster_id</span><span class="p">,</span>
                                                     <span class="n">transaction_type</span><span class="o">=</span><span class="s1">&#39;sale&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;Date&#39;</span><span class="p">]),</span>
                        <span class="n">price_trends_dict</span><span class="o">=</span><span class="n">get_price_trends</span><span class="p">(</span><span class="n">cluster_id</span><span class="o">=</span><span class="n">cluster_id</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cluster_id for </span><span class="si">{}</span><span class="s1"> could not be found ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">condo_url</span><span class="p">))</span>
                <span class="c1"># Save the TransactionHistory objects acquired after each property scraping</span>
                <span class="n">save_object</span><span class="p">(</span><span class="n">transaction_history</span><span class="p">,</span> <span class="s1">&#39;./data/99.co/transaction_history.pkl&#39;</span><span class="p">)</span>

    <span class="k">finally</span><span class="p">:</span>
        <span class="n">save_object</span><span class="p">(</span><span class="n">transaction_history</span><span class="p">,</span> <span class="s1">&#39;./data/99.co/transaction_history.pkl&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">transaction_history</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run this once</span>
<span class="c1"># condo_transaction_history = get_transactions(condo_X, districts=[9, 10, 11])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in the transaction histories of the district 9, 10, 11 condos</span>
<span class="n">condo_transaction_history_saved</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./data/99.co/transaction_history.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_property_dev_shape</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function:</span>
<span class="sd">    ---------</span>
<span class="sd">    Retrieves the latitude and longitude coordinates from 99.co&#39;s </span>
<span class="sd">    webpage through the specified url, and get&#39;s the coordinates of the master plan</span>
<span class="sd">    area from URA</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    url: The property development webpage from 99.co</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    Polygon object of the coordinates of the property development</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;query_coords&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">query_coords_pos</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;query_coords&#39;</span><span class="p">)</span>
            <span class="n">first_occurence</span> <span class="o">=</span> <span class="p">[</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">():</span><span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span><span class="o">+</span><span class="mi">100</span><span class="p">]</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;query_coords&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">first_occurence</span><span class="p">:</span>
                <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">first_occurence</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">first_occurence</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
            
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;returnGeometry&#39;</span><span class="p">:</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;where&#39;</span><span class="p">:</span> <span class="s1">&#39;1=1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;outSr&#39;</span><span class="p">:</span> <span class="s1">&#39;4326&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;outFields&#39;</span><span class="p">:</span> <span class="s1">&#39;name,lu_desc,lu_dt_cd,gpr_num,region_n,pln_area_n,subzone_n&#39;</span><span class="p">,</span>
                <span class="s1">&#39;inSr&#39;</span><span class="p">:</span> <span class="s1">&#39;4326&#39;</span><span class="p">,</span>
                <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="s1">&#39;spatialReference&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wkid&#39;</span><span class="p">:</span> <span class="mi">4326</span><span class="p">}</span> <span class="p">}),</span>
                <span class="s1">&#39;geometryType&#39;</span><span class="p">:</span> <span class="s1">&#39;esriGeometryPoint&#39;</span><span class="p">,</span>
                <span class="s1">&#39;spatialRel&#39;</span><span class="p">:</span> <span class="s1">&#39;esriSpatialRelWithin&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="s1">&#39;json&#39;</span>
            <span class="p">}</span>

            <span class="c1"># Get the Shape of the property development from</span>
            <span class="c1"># the URA website</span>
            <span class="n">ura_res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.ura.gov.sg/arcgis/rest/services/maps2/Updated_Gaz_MP14_Land_Use_Maps/MapServer/55/query&#39;</span><span class="p">,</span> 
                                   <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">ura_res</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">ura_res</span><span class="o">.</span><span class="n">text</span><span class="p">)[</span><span class="s1">&#39;features&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;rings&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to request coordinates from URA ...&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to find query_coords from </span><span class="si">{}</span><span class="s1"> source ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to request </span><span class="si">{}</span><span class="s1"> ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
        
<span class="k">def</span> <span class="nf">get_development_gdf</span><span class="p">(</span><span class="n">condo_transaction_history_saved</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function:</span>
<span class="sd">    ---------</span>
<span class="sd">    Retrieve the </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">property_development_info</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">condo_cluster_id</span><span class="p">,</span> <span class="n">transaction_history_data</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">condo_transaction_history_saved</span><span class="o">.</span><span class="n">items</span><span class="p">())):</span>
        <span class="n">property_dev_shape</span> <span class="o">=</span> <span class="n">get_property_dev_shape</span><span class="p">(</span><span class="n">transaction_history_data</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">property_dev_shape</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">property_development_info</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">condo_cluster_id</span><span class="p">,</span> 
                                              <span class="n">transaction_history_data</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
                                              <span class="n">property_dev_shape</span><span class="p">))</span>
            
    <span class="c1"># Unzip the data</span>
    <span class="n">ids</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">shapes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">property_development_info</span><span class="p">))</span>  
    
    <span class="c1"># Create the Geodataframe</span>
    <span class="n">development_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">shapes</span><span class="p">)),</span>
                                       <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">],</span>
                                       <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span>
                                       <span class="n">index</span><span class="o">=</span><span class="n">ids</span><span class="p">)</span>

    <span class="c1"># Initialize which Coordinate Reference System</span>
    <span class="c1"># the Polygons are from</span>
    <span class="n">development_gdf</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="s1">&#39;epsg:4326&#39;</span><span class="p">}</span>

    <span class="c1"># Convert to Singapore&#39;s Coordinate Reference System</span>
    <span class="n">development_gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">({</span><span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="s1">&#39;epsg:3414&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Add the areas of each property to the dataframe and return it</span>
    <span class="n">development_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">development_gdf</span><span class="p">,</span>
                                     <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">shape</span><span class="o">.</span><span class="n">area</span> <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">development_gdf</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]],</span>
                                               <span class="n">name</span><span class="o">=</span><span class="s1">&#39;area&#39;</span><span class="p">,</span>
                                               <span class="n">index</span><span class="o">=</span><span class="n">development_gdf</span><span class="o">.</span><span class="n">index</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">development_gdf</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;./data/99.co/development_gdf.csv&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">development_gdf</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run this once</span>
<span class="c1"># development_gdf = get_development_gdf(condo_transaction_history_saved)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in the csv saved after running the function on top once</span>
<span class="n">development_gdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/99.co/development_gdf.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">development_gdf</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">development_gdf</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">wkt</span><span class="o">.</span><span class="n">loads</span><span class="p">)</span>
<span class="n">development_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">development_gdf</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>
<span class="n">development_gdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>geometry</th>
      <th>area</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>deBww68UZiCQC9buT6HJHn94</th>
      <td>visioncrest</td>
      <td>POLYGON ((29120.39317503387 31253.28339999881,...</td>
      <td>11289.354705</td>
    </tr>
    <tr>
      <th>dezffmfUfU7j2AZq7SaCZcAV</th>
      <td>oxley-edge</td>
      <td>POLYGON ((28939.530100035 30894.11250000041, 2...</td>
      <td>203.460535</td>
    </tr>
    <tr>
      <th>de64sRpu6B5kL5ZMqsy3aY83</th>
      <td>up-robertson-quay</td>
      <td>POLYGON ((28491.80500003405 30342.27099999937,...</td>
      <td>4426.059840</td>
    </tr>
    <tr>
      <th>derjk2a5yZokjVVzgWUYuGQk</th>
      <td>martin-modern</td>
      <td>POLYGON ((28482.45400003335 30697.33899999934,...</td>
      <td>15932.145784</td>
    </tr>
    <tr>
      <th>deN7jqPZMK4qXzbqkDinAfG</th>
      <td>8-saint-thomas</td>
      <td>POLYGON ((28309.86910003353 30930.41400000046,...</td>
      <td>5544.545664</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We see that we’ve amassed a GeoDataFrame of the <code class="docutils literal notranslate"><span class="pre">name</span></code>s of the property developments, their <code class="docutils literal notranslate"><span class="pre">geometry</span></code>, as well as their <code class="docutils literal notranslate"><span class="pre">area</span></code> calculated from their <code class="docutils literal notranslate"><span class="pre">geometry</span></code>. Let’s plot them out to see how their shapes look like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fontprops</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">development_gdf</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">21e3</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">32e3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">30e3</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">37e3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;District 9, 10, 11 Property Patches&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_66_0.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_66_0.png" />
</div>
</div>
<p>Let’s take a look at the top 10 property developments with the largest land plots.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top_k_largest_land_plots</span> <span class="o">=</span> <span class="n">development_gdf</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;area&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">top_k_largest_land_plots</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>geometry</th>
      <th>area</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dexBL54KXwLzrouFwRDi3hN7</th>
      <td>wilshire-residences</td>
      <td>POLYGON ((30864.27887503527 31052.52227500042,...</td>
      <td>115716.593256</td>
    </tr>
    <tr>
      <th>deqZxRuu57uzrKmn4Ens5J36</th>
      <td>regency-park</td>
      <td>POLYGON ((27256.02700003375 30869.03209999915,...</td>
      <td>47087.735977</td>
    </tr>
    <tr>
      <th>deF68BvbTj2wLYXpAj7dczwn</th>
      <td>hillcrest-arcadia</td>
      <td>POLYGON ((25416.56400003488 35198.50999999946,...</td>
      <td>42056.124362</td>
    </tr>
    <tr>
      <th>dew7TKjVatAm5hFhmjKLdX7M</th>
      <td>valley-park</td>
      <td>POLYGON ((27551.09300003419 30793.11299999955,...</td>
      <td>39980.056713</td>
    </tr>
    <tr>
      <th>deuaJk2pf8VRU9SMeXmiwDEe</th>
      <td>yong-an-park</td>
      <td>POLYGON ((28045.51162503337 30927.67840000017,...</td>
      <td>36974.237415</td>
    </tr>
    <tr>
      <th>de9nYaVhEPfhbNsjBHpDAF66</th>
      <td>ardmore-park</td>
      <td>POLYGON ((27606.33570003401 32578.22629999893,...</td>
      <td>32011.124393</td>
    </tr>
    <tr>
      <th>deFd5qdc9n8hLashEVsHZHMm</th>
      <td>aspen-heights</td>
      <td>POLYGON ((28896.49600003314 30847.51899999905,...</td>
      <td>31986.958901</td>
    </tr>
    <tr>
      <th>deVCdvkVV4jAfqfD7ADWXpha</th>
      <td>ue-square</td>
      <td>POLYGON ((29030.28200003355 30662.6758999989, ...</td>
      <td>29451.902802</td>
    </tr>
    <tr>
      <th>deMkfRvrfJxgcNDUD88bZZr4</th>
      <td>duchess-crest</td>
      <td>POLYGON ((24714.44400003357 34142.49999999967,...</td>
      <td>29194.881756</td>
    </tr>
    <tr>
      <th>deDvLbh3PZNsQDf8eU8RayE5</th>
      <td>four-seasons-park</td>
      <td>POLYGON ((27528.63000003443 31865.73899999973,...</td>
      <td>27849.010938</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">development_gdf_sorted</span> <span class="o">=</span> <span class="n">development_gdf</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;area&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">development_gdf_sorted</span><span class="p">[:</span><span class="mi">50</span><span class="p">],</span> 
           <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">development_gdf_sorted</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>geometry</th>
      <th>area</th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dexBL54KXwLzrouFwRDi3hN7</th>
      <td>wilshire-residences</td>
      <td>POLYGON ((30864.27887503527 31052.52227500042,...</td>
      <td>115716.593256</td>
      <td>0</td>
    </tr>
    <tr>
      <th>deqZxRuu57uzrKmn4Ens5J36</th>
      <td>regency-park</td>
      <td>POLYGON ((27256.02700003375 30869.03209999915,...</td>
      <td>47087.735977</td>
      <td>1</td>
    </tr>
    <tr>
      <th>deF68BvbTj2wLYXpAj7dczwn</th>
      <td>hillcrest-arcadia</td>
      <td>POLYGON ((25416.56400003488 35198.50999999946,...</td>
      <td>42056.124362</td>
      <td>2</td>
    </tr>
    <tr>
      <th>dew7TKjVatAm5hFhmjKLdX7M</th>
      <td>valley-park</td>
      <td>POLYGON ((27551.09300003419 30793.11299999955,...</td>
      <td>39980.056713</td>
      <td>3</td>
    </tr>
    <tr>
      <th>deuaJk2pf8VRU9SMeXmiwDEe</th>
      <td>yong-an-park</td>
      <td>POLYGON ((28045.51162503337 30927.67840000017,...</td>
      <td>36974.237415</td>
      <td>4</td>
    </tr>
    <tr>
      <th>de9nYaVhEPfhbNsjBHpDAF66</th>
      <td>ardmore-park</td>
      <td>POLYGON ((27606.33570003401 32578.22629999893,...</td>
      <td>32011.124393</td>
      <td>5</td>
    </tr>
    <tr>
      <th>deFd5qdc9n8hLashEVsHZHMm</th>
      <td>aspen-heights</td>
      <td>POLYGON ((28896.49600003314 30847.51899999905,...</td>
      <td>31986.958901</td>
      <td>6</td>
    </tr>
    <tr>
      <th>deVCdvkVV4jAfqfD7ADWXpha</th>
      <td>ue-square</td>
      <td>POLYGON ((29030.28200003355 30662.6758999989, ...</td>
      <td>29451.902802</td>
      <td>7</td>
    </tr>
    <tr>
      <th>deMkfRvrfJxgcNDUD88bZZr4</th>
      <td>duchess-crest</td>
      <td>POLYGON ((24714.44400003357 34142.49999999967,...</td>
      <td>29194.881756</td>
      <td>8</td>
    </tr>
    <tr>
      <th>deDvLbh3PZNsQDf8eU8RayE5</th>
      <td>four-seasons-park</td>
      <td>POLYGON ((27528.63000003443 31865.73899999973,...</td>
      <td>27849.010938</td>
      <td>9</td>
    </tr>
    <tr>
      <th>deBdXMF9jHqZsWyBhAvRCa5M</th>
      <td>rivergate</td>
      <td>POLYGON ((28346.65200003377 30560.27399999987,...</td>
      <td>27314.108611</td>
      <td>10</td>
    </tr>
    <tr>
      <th>defodSmXzEoqBaA4zshQ6zEm</th>
      <td>the-tessarina</td>
      <td>POLYGON ((23221.28857503369 34917.71904999913,...</td>
      <td>26803.759250</td>
      <td>11</td>
    </tr>
    <tr>
      <th>deuGUxmbqiTLaNzojps4gQhT</th>
      <td>goodwood-residence</td>
      <td>POLYGON ((28356.82400003443 33081.13099999882,...</td>
      <td>24847.641976</td>
      <td>12</td>
    </tr>
    <tr>
      <th>dewsGYWhq5evJtGMgomfGVvU</th>
      <td>spring-grove</td>
      <td>POLYGON ((27427.16100003391 31245.6109999992, ...</td>
      <td>24482.291340</td>
      <td>13</td>
    </tr>
    <tr>
      <th>deAXZibNCJ8ctpYcp62Wvr9H</th>
      <td>belle-vue-residences</td>
      <td>POLYGON ((29024.32300003441 31099.14599999937,...</td>
      <td>23016.656333</td>
      <td>14</td>
    </tr>
    <tr>
      <th>dejBigVZWsWRgeZTd2d2KtnM</th>
      <td>dleedon</td>
      <td>POLYGON ((24552.24100003411 33181.35299999976,...</td>
      <td>22977.799497</td>
      <td>15</td>
    </tr>
    <tr>
      <th>decBLjHdGkqjic7CVLFFxHaF</th>
      <td>the-claymore</td>
      <td>POLYGON ((27846.59100003378 32435.01400000013,...</td>
      <td>22864.225707</td>
      <td>16</td>
    </tr>
    <tr>
      <th>deD6oC7GUYHr3GrvtgRWgjGg</th>
      <td>nassim-park-residences</td>
      <td>POLYGON ((26965.55100003329 32184.46000000052,...</td>
      <td>22843.050973</td>
      <td>17</td>
    </tr>
    <tr>
      <th>deAGLpf2jaMvYzpgqaidR6Y6</th>
      <td>parvis</td>
      <td>POLYGON ((24321.20060003381 32561.48819999924,...</td>
      <td>22605.698107</td>
      <td>18</td>
    </tr>
    <tr>
      <th>deZuKN9pYhCTy8LpaBbKav27</th>
      <td>the-nassim</td>
      <td>POLYGON ((26793.22200003375 32280.92999999935,...</td>
      <td>22000.107561</td>
      <td>19</td>
    </tr>
    <tr>
      <th>deWMKjqeYhExbQQfGfHD75fS</th>
      <td>the-shelford</td>
      <td>POLYGON ((25542.46510003378 34274.82799999935,...</td>
      <td>21599.152687</td>
      <td>20</td>
    </tr>
    <tr>
      <th>devGGphgYa2gSXi4t9KSakrj</th>
      <td>midtown-bay</td>
      <td>POLYGON ((30745.37605003366 31154.37674999949,...</td>
      <td>21437.064839</td>
      <td>21</td>
    </tr>
    <tr>
      <th>deMCHWqYYLTQib8UAZjW3VPn</th>
      <td>park-infinia-wee-nam</td>
      <td>POLYGON ((29130.88400003368 33098.40699999932,...</td>
      <td>20859.397759</td>
      <td>22</td>
    </tr>
    <tr>
      <th>deCVNkLq8EEZvB8Hw3YVusET</th>
      <td>glentrees</td>
      <td>POLYGON ((22630.67800003427 33300.49300000034,...</td>
      <td>20631.851869</td>
      <td>23</td>
    </tr>
    <tr>
      <th>de54iQoJQq8jpJKGKHAAgsb8</th>
      <td>horizon-towers</td>
      <td>POLYGON ((28013.78320003394 31110.93229999916,...</td>
      <td>19030.230374</td>
      <td>24</td>
    </tr>
    <tr>
      <th>deyhDdb9PrNGBzZ9AUFBMUiW</th>
      <td>120-grange</td>
      <td>POLYGON ((27840.39717503393 31901.83412499871,...</td>
      <td>18649.585186</td>
      <td>25</td>
    </tr>
    <tr>
      <th>der4QDjqEPRUJ2kGW9oPtSDH</th>
      <td>the-orchard-residences</td>
      <td>POLYGON ((27840.39717503393 31901.83412499871,...</td>
      <td>18649.585186</td>
      <td>26</td>
    </tr>
    <tr>
      <th>deBhYU8diNDt6RpaGZCAsS3H</th>
      <td>the-trizon</td>
      <td>POLYGON ((21921.10800003582 33221.22799999984,...</td>
      <td>18155.161200</td>
      <td>27</td>
    </tr>
    <tr>
      <th>dejbqYpj7rE63GWVpdsP3hqb</th>
      <td>sky-eleven</td>
      <td>POLYGON ((28838.94070003406 34766.41410000031,...</td>
      <td>17073.118907</td>
      <td>28</td>
    </tr>
    <tr>
      <th>deiB7PNt9YuoB4iwH7o6GF78</th>
      <td>tanglin-hill-condominium</td>
      <td>POLYGON ((26301.48240003422 31510.04099999894,...</td>
      <td>16933.604630</td>
      <td>29</td>
    </tr>
    <tr>
      <th>deYtztrsP6T6v7pF6hCGwx95</th>
      <td>fyve-derbyshire</td>
      <td>POLYGON ((29203.3156000327 33608.07080000049, ...</td>
      <td>16768.201291</td>
      <td>30</td>
    </tr>
    <tr>
      <th>devBccS2NKDRAiJ7xsa4LAem</th>
      <td>fourth-avenue-residences</td>
      <td>POLYGON ((23962.04202503444 34785.76152499916,...</td>
      <td>16752.771975</td>
      <td>31</td>
    </tr>
    <tr>
      <th>denahNTyio3Kz7ccwceCmRvZ</th>
      <td>gallop-gables</td>
      <td>POLYGON ((25281.01700003423 32917.37499999964,...</td>
      <td>16474.760812</td>
      <td>32</td>
    </tr>
    <tr>
      <th>deoLYhmPUeFN5dBZhRoABcRA</th>
      <td>the-sixth-avenue-residences</td>
      <td>POLYGON ((23481.38000003402 34427.02700000033,...</td>
      <td>16056.964643</td>
      <td>33</td>
    </tr>
    <tr>
      <th>derjk2a5yZokjVVzgWUYuGQk</th>
      <td>martin-modern</td>
      <td>POLYGON ((28482.45400003335 30697.33899999934,...</td>
      <td>15932.145784</td>
      <td>34</td>
    </tr>
    <tr>
      <th>deCrr3gTcRhYepVhwysk8v5M</th>
      <td>the-glyndebourne</td>
      <td>POLYGON ((27015.94100003427 33833.77399999988,...</td>
      <td>15863.840333</td>
      <td>35</td>
    </tr>
    <tr>
      <th>deJUtFkqxPoiinFM5wp56YC6</th>
      <td>8-mount-sophia</td>
      <td>POLYGON ((29440.17810003455 31546.10179999995,...</td>
      <td>15801.152852</td>
      <td>36</td>
    </tr>
    <tr>
      <th>de2N2BWSZziKW4rqmKzFuLcP</th>
      <td>sophia-residence</td>
      <td>POLYGON ((29723.49370003406 31557.22299999899,...</td>
      <td>15289.673387</td>
      <td>37</td>
    </tr>
    <tr>
      <th>deNKmXtF4ncqrqmqrDYBHjsj</th>
      <td>belmond-green</td>
      <td>POLYGON ((27825.67500003413 33134.6170000002, ...</td>
      <td>15225.105701</td>
      <td>38</td>
    </tr>
    <tr>
      <th>de6DUYWzwGE3JqpqdqR7Y8g5</th>
      <td>the-draycott</td>
      <td>POLYGON ((27825.02290003409 32714.05890000021,...</td>
      <td>14971.453790</td>
      <td>39</td>
    </tr>
    <tr>
      <th>dessrBwHLsL4dZZ9WjepW6k6</th>
      <td>cairnhill-crest</td>
      <td>POLYGON ((28649.43600003399 32014.76899999906,...</td>
      <td>14508.364835</td>
      <td>40</td>
    </tr>
    <tr>
      <th>de2WZRDYyLayorUHcQ83pE46</th>
      <td>st-regis-residences-singapore</td>
      <td>POLYGON ((27232.19700003383 32056.72299999891,...</td>
      <td>14231.535480</td>
      <td>41</td>
    </tr>
    <tr>
      <th>deeJLKXrkPRxjHAGpq79gMpg</th>
      <td>draycott-8</td>
      <td>POLYGON ((27852.7230000338 32662.71599999961, ...</td>
      <td>14214.558419</td>
      <td>42</td>
    </tr>
    <tr>
      <th>de9A83rhqSAMSoLuKAZF94DY</th>
      <td>duchess-residences</td>
      <td>POLYGON ((24360.52730003348 33991.25459999931,...</td>
      <td>14124.429448</td>
      <td>43</td>
    </tr>
    <tr>
      <th>def8mPzTx6CHzFCEB4DqSuyT</th>
      <td>beverly-hill</td>
      <td>POLYGON ((27147.06090003438 31292.01730000007,...</td>
      <td>13830.534232</td>
      <td>44</td>
    </tr>
    <tr>
      <th>de5wX3BfHEGktkEVydZPzap9</th>
      <td>leonie-gardens</td>
      <td>POLYGON ((27979.23300003359 31248.71699999987,...</td>
      <td>13534.430389</td>
      <td>45</td>
    </tr>
    <tr>
      <th>des64ic2dN5dUibYK3jSNPM6</th>
      <td>riviere</td>
      <td>POLYGON ((28241.45105003459 30377.3530999996, ...</td>
      <td>13476.952057</td>
      <td>46</td>
    </tr>
    <tr>
      <th>detpccvTCXEvCTFP87CVJ2bH</th>
      <td>rv-altitude</td>
      <td>POLYGON ((30860.545925034 31055.98782500031, 3...</td>
      <td>13333.663318</td>
      <td>47</td>
    </tr>
    <tr>
      <th>deBfyPZMNCKVa6AKnVsM23MQ</th>
      <td>gallop-green</td>
      <td>POLYGON ((25297.77400003488 33016.53499999979,...</td>
      <td>13317.125663</td>
      <td>48</td>
    </tr>
    <tr>
      <th>deWMAF2fBr8GAGckfBMHrjR8</th>
      <td>waterfall-gardens</td>
      <td>POLYGON ((24907.89497503285 32744.63367499935,...</td>
      <td>13187.163262</td>
      <td>49</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fontprops</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Get color for each property</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">get_colors</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">cluster_id</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">top_k_largest_land_plots</span><span class="p">[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">PolygonPatch</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">],</span> <span class="n">fc</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">ec</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">))</span>
        
<span class="n">bar</span> <span class="o">=</span> <span class="n">AnchoredSizeBar</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span> 
                      <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1m&#39;</span><span class="p">,</span> 
                      <span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> 
                      <span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> 
                      <span class="n">sep</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
                      <span class="n">borderpad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> 
                      <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                      <span class="n">size_vertical</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> 
                      <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                      <span class="n">fontproperties</span><span class="o">=</span><span class="n">fontprops</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">color</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">top_k_largest_land_plots</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">24e3</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">32e3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">30e3</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">35.5e3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;District 9, 10, 11 Top 10 Land Plots Property Patches&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_70_0.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_70_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an empty dictionary of the top 10 </span>
<span class="c1"># largest land plot developments as keys to  </span>
<span class="c1"># store their transaction history dataframes as the values</span>
<span class="n">condos_of_interest</span> <span class="o">=</span> <span class="p">{</span><span class="n">cluster_id</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">cluster_id</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">top_k_largest_land_plots</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()}</span>

<span class="c1"># Get all the transaction history of SALES of</span>
<span class="c1"># the condos of interest and append a column</span>
<span class="c1"># of the days since the transactiomn from today</span>
<span class="c1"># to the dataframe, storing everything in</span>
<span class="c1"># condos_of_interest</span>
<span class="k">for</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="n">condos_of_interest</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">condo_of_interest_transact_history</span> <span class="o">=</span> <span class="n">condo_transaction_history_saved</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span><span class="o">.</span><span class="n">sale</span>
    <span class="n">condos_of_interest</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span>
        <span class="n">condo_of_interest_transact_history</span><span class="p">,</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([(</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m/%Y&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">condo_of_interest_transact_history</span><span class="o">.</span><span class="n">index</span><span class="p">],</span> 
                  <span class="n">index</span><span class="o">=</span><span class="n">condo_of_interest_transact_history</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;days_since_transaction&#39;</span><span class="p">)],</span> 
                                        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The function below will be used to clean each row of the dataframe we’ve gathered of the transaction history of the property development.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_prices</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function:</span>
<span class="sd">    ---------</span>
<span class="sd">    Cleans a dataframe row</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    row: A pandas dataframe row </span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    tuple of (price per square foot, floor level, total price, days since transaction)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;[^0-9\.]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Price (psf)&#39;</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;[^0-9]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Unit&#39;</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">price</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;[^0-9\.]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Price (psf)&#39;</span><span class="p">]))</span>
        <span class="n">area</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Area&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">floor</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;[^0-9]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Unit&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Price (psf)&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">price</span><span class="o">/</span><span class="n">area</span><span class="p">)</span><span class="o">*</span><span class="mf">1e6</span><span class="p">,</span> 
                    <span class="n">floor</span><span class="p">,</span>
                    <span class="n">price</span><span class="o">*</span><span class="mf">1e6</span><span class="p">,</span> 
                    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;days_since_transaction&#39;</span><span class="p">])</span>  
        <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Price (psf)&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> 
            <span class="k">return</span> <span class="p">((</span><span class="n">price</span><span class="o">/</span><span class="n">area</span><span class="p">)</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span>
                    <span class="n">floor</span><span class="p">,</span> 
                    <span class="n">price</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> 
                    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;days_since_transaction&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">price</span><span class="o">/</span><span class="n">area</span><span class="p">),</span>
                    <span class="n">floor</span><span class="p">,</span> 
                    <span class="n">price</span><span class="p">,</span> 
                    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;days_since_transaction&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Get a set of all the days since transactions for </span>
<span class="c1"># each condo of interest</span>
<span class="n">days_since_transactions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">days</span> <span class="k">for</span> <span class="n">cluster_id</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">condos_of_interest</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">days</span> <span class="ow">in</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;days_since_transaction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">])</span>

<span class="c1"># Scaler for the days since transactions so</span>
<span class="c1"># we can display older transactions by a </span>
<span class="c1"># diff color to distinguish from newer ones</span>
<span class="n">days_scaler</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">days_since_transactions</span><span class="p">),</span>
                                        <span class="n">vmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">days_since_transactions</span><span class="p">))</span>

<span class="c1"># Aggregated condo sale psf and prices dataframe</span>
<span class="n">condos_of_interest_all_psf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">condos_of_interest_all_price</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">condos_of_interest_all_days_since_transaction</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">condo_names</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Get all the names of the condos of interest from condo_transaction_history_saved</span>

<span class="c1"># Plots each transaction of each property</span>
<span class="c1"># Deeper colors signify more recent transactions while</span>
<span class="c1"># Lighter colors are older transactions</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">cluster_id</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">condos_of_interest</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    
    <span class="c1"># Get the condo name from condo_transaction_history_saved dictionary</span>
    <span class="n">condo_name</span> <span class="o">=</span> <span class="n">condo_transaction_history_saved</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">condo_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">condo_name</span><span class="p">)</span>
    
    <span class="c1"># Unpack the tuple of psf, level, price and days_since_transaction</span>
    <span class="n">psf</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">days_since_transaction</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_prices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))))</span>
    
    <span class="c1"># Only get the last 10 transactions</span>
    <span class="n">psf</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">days_since_transaction</span> <span class="o">=</span> <span class="n">psf</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">level</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">price</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">days_since_transaction</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">psf</span><span class="p">,</span> 
                     <span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">autumn</span><span class="p">(</span><span class="n">days_scaler</span><span class="p">(</span><span class="n">val</span><span class="p">))</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">days_since_transaction</span><span class="p">],</span> 
                     <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*sovXPD^v&gt;&lt;&#39;</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">condo_name</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> 
                     <span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">autumn</span><span class="p">(</span><span class="n">days_scaler</span><span class="p">(</span><span class="n">val</span><span class="p">))</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">days_since_transaction</span><span class="p">],</span> 
                     <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*sovXPD^v&gt;&lt;&#39;</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">condo_name</span><span class="p">)</span>
    <span class="n">condos_of_interest_all_psf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">condos_of_interest_all_psf</span><span class="p">,</span>
                                            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">psf</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">condo_name</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">condos_of_interest_all_price</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">condos_of_interest_all_price</span><span class="p">,</span>
                                            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">condo_name</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">condos_of_interest_all_days_since_transaction</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">condos_of_interest_all_days_since_transaction</span><span class="p">,</span> 
                                                               <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">days_since_transaction</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">condo_name</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PSF ($ / sqft)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Floor&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PSF Vs Floor&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Price ($)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Floor&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Price Vs Floor&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">condos_of_interest_all_psf</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="n">condo_names</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">rot</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PSF ($ / sqft)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Condominium&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Box and Whisker Plot of PSF ($ / sqft) Distribution&#39;</span><span class="p">)</span>

<span class="n">condos_of_interest_all_price</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="n">condo_names</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">rot</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Price ($)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Condominium&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Box and Whisker Plot of Price ($) Distribution&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/exploring-house-prices-singapore-part-3-crispdm_74_0.png" src="../../_images/exploring-house-prices-singapore-part-3-crispdm_74_0.png" />
</div>
</div>
<p><em>In the <code class="docutils literal notranslate"><span class="pre">PSF</span> <span class="pre">Vs.</span> <span class="pre">Floor</span></code> and <code class="docutils literal notranslate"><span class="pre">Price</span> <span class="pre">Vs.</span> <span class="pre">Floor</span></code> plots, the deeper the color (more red), the more recent the transaction has taken place.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">condos_of_interest_all_days_since_transaction</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wilshire-residences</th>
      <th>regency-park</th>
      <th>hillcrest-arcadia</th>
      <th>valley-park</th>
      <th>yong-an-park</th>
      <th>ardmore-park</th>
      <th>aspen-heights</th>
      <th>ue-square</th>
      <th>duchess-crest</th>
      <th>four-seasons-park</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>77.0</td>
      <td>196</td>
      <td>28</td>
      <td>25</td>
      <td>98</td>
      <td>52</td>
      <td>32</td>
      <td>52</td>
      <td>42</td>
      <td>112</td>
    </tr>
    <tr>
      <th>1</th>
      <td>96.0</td>
      <td>252</td>
      <td>35</td>
      <td>84</td>
      <td>102</td>
      <td>81</td>
      <td>46</td>
      <td>61</td>
      <td>59</td>
      <td>388</td>
    </tr>
    <tr>
      <th>2</th>
      <td>99.0</td>
      <td>350</td>
      <td>56</td>
      <td>87</td>
      <td>215</td>
      <td>89</td>
      <td>76</td>
      <td>123</td>
      <td>367</td>
      <td>406</td>
    </tr>
    <tr>
      <th>3</th>
      <td>99.0</td>
      <td>412</td>
      <td>67</td>
      <td>146</td>
      <td>244</td>
      <td>173</td>
      <td>96</td>
      <td>158</td>
      <td>453</td>
      <td>462</td>
    </tr>
    <tr>
      <th>4</th>
      <td>100.0</td>
      <td>424</td>
      <td>81</td>
      <td>206</td>
      <td>340</td>
      <td>173</td>
      <td>108</td>
      <td>363</td>
      <td>458</td>
      <td>563</td>
    </tr>
    <tr>
      <th>5</th>
      <td>NaN</td>
      <td>455</td>
      <td>111</td>
      <td>235</td>
      <td>665</td>
      <td>192</td>
      <td>125</td>
      <td>367</td>
      <td>467</td>
      <td>641</td>
    </tr>
    <tr>
      <th>6</th>
      <td>NaN</td>
      <td>559</td>
      <td>129</td>
      <td>241</td>
      <td>682</td>
      <td>251</td>
      <td>158</td>
      <td>371</td>
      <td>517</td>
      <td>672</td>
    </tr>
    <tr>
      <th>7</th>
      <td>NaN</td>
      <td>606</td>
      <td>131</td>
      <td>279</td>
      <td>742</td>
      <td>329</td>
      <td>215</td>
      <td>390</td>
      <td>535</td>
      <td>781</td>
    </tr>
    <tr>
      <th>8</th>
      <td>NaN</td>
      <td>619</td>
      <td>241</td>
      <td>306</td>
      <td>805</td>
      <td>475</td>
      <td>216</td>
      <td>398</td>
      <td>535</td>
      <td>860</td>
    </tr>
    <tr>
      <th>9</th>
      <td>NaN</td>
      <td>619</td>
      <td>264</td>
      <td>346</td>
      <td>880</td>
      <td>490</td>
      <td>238</td>
      <td>412</td>
      <td>538</td>
      <td>966</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As we can see, <code class="docutils literal notranslate"><span class="pre">hillcrest-arcadia</span></code> and <code class="docutils literal notranslate"><span class="pre">aspen-heights</span></code> seem to have the most frequent transactions recently and <code class="docutils literal notranslate"><span class="pre">wilshire-residences</span></code> has the shortest transaction history out of all the property developments in districts 9, 10, 11 with the largest land plots. Another noteworthy point would be that <code class="docutils literal notranslate"><span class="pre">ardmore-park</span></code> has the highest price per square foot as seen from the box and whisker’s plot, and <code class="docutils literal notranslate"><span class="pre">leedon-residence</span></code> has the greatest standard deviation in  transaction prices.</p>
</div>
<div class="section" id="visualize-evolution-of-psf-over-time-for-d9-10-11-condos-to-be-continued">
<h3>4. Visualize Evolution of PSF over time for D9, 10, 11 Condos [To Be Continued]<a class="headerlink" href="#visualize-evolution-of-psf-over-time-for-d9-10-11-condos-to-be-continued" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_condos_cleaned_transact_history</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">condo_transaction_history_saved</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="n">sale_transaction_history</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span>
        <span class="n">condo_transaction_history_saved</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span><span class="o">.</span><span class="n">sale</span><span class="p">,</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([(</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m/%Y&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">condo_transaction_history_saved</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span><span class="o">.</span><span class="n">sale</span><span class="o">.</span><span class="n">index</span><span class="p">],</span> 
                  <span class="n">index</span><span class="o">=</span><span class="n">condo_transaction_history_saved</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span><span class="o">.</span><span class="n">sale</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;days_since_transaction&#39;</span><span class="p">)],</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">psf</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">days_since_transaction</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">sale_transaction_history</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_prices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))))</span>
    <span class="n">all_condos_cleaned_transact_history</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">psf</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">days_since_transaction</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;psf&#39;</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;days_since_transaction&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 301/301 [00:03&lt;00:00, 91.69it/s] 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psfs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">cluster_id</span><span class="p">,</span> <span class="n">cleaned_transaction_history</span> <span class="ow">in</span> <span class="n">all_condos_cleaned_transact_history</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">condo_transaction_history_saved</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span><span class="o">.</span><span class="n">sale</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">psfs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cluster_id</span><span class="p">,</span> <span class="n">condo_transaction_history_saved</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">cleaned_transaction_history</span><span class="p">[</span><span class="s1">&#39;psf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
    
<span class="nb">sorted</span><span class="p">(</span><span class="n">psfs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">val</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;deW3uHXDGJi6UaiJjkNL43Ja&#39;, &#39;the-marq-on-paterson-hill&#39;, 6840.492840492841),
 (&#39;dedxy2cVh9LsnfXCEL25t89G&#39;, &#39;twentyone-angullia-park&#39;, 5559.989634620368),
 (&#39;de2fsyAsihPdsy7LdzjmSFLV&#39;, &#39;the-ritzcarlton-residences&#39;, 5145.567549885509),
 (&#39;dep92pCMVNVWNK3vntHivs6j&#39;, &#39;boulevard-88&#39;, 5124.81401884609),
 (&#39;deAuZ9ecUBhhZGcyUK7r2cRJ&#39;, &#39;skyline-orchard-boulevard&#39;, 5011.945845500399),
 (&#39;deHwvYsc6Se2q8ojmrxynboQ&#39;, &#39;reignwood-hamilton-scotts&#39;, 5000.0),
 (&#39;der4QDjqEPRUJ2kGW9oPtSDH&#39;, &#39;the-orchard-residences&#39;, 4999.999999999999),
 (&#39;de9KYTFKJ4B68yXkPKUnouD3&#39;, &#39;boulevard-vue&#39;, 4912.460920053595),
 (&#39;deqcgHYSkWAMfVf56cuhriM6&#39;, &#39;hilltops&#39;, 4812.170385395538),
 (&#39;dep4qchyRszaoycMW2sddQhU&#39;, &#39;3-orchard-bythepark&#39;, 4805.491990846682)]
</pre></div>
</div>
</div>
</div>
<p><a id='eval'></a></p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="evaluation-to-be-continued">
<h2>Evaluation [To Be Continued]<a class="headerlink" href="#evaluation-to-be-continued" title="Permalink to this headline">¶</a></h2>
<p><a id='deploy'></a></p>
</div>
<hr class="docutils" />
<div class="section" id="deployment-to-be-continued">
<h2>Deployment [To Be Continued]<a class="headerlink" href="#deployment-to-be-continued" title="Permalink to this headline">¶</a></h2>
<p><a id='resources'></a></p>
</div>
<hr class="docutils" />
<div class="section" id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>https://www.99.co/blog/singapore/a-general-guide-to-types-of-housing-in-singapore/</p></li>
<li><p>https://www.99.co/blog/singapore/freehold-vs-leasehold-condos/</p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./course-work/udacity"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="../cais%2B%2B/intro.html" title="previous page">Center for AI in Society’s Student Branch (CAIS++)</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Chengyi (Jeff) Chen<br/>
        
            &copy; Copyright 2022.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>